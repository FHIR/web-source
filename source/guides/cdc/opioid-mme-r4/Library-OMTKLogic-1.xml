<?xml version="1.0" encoding="UTF-8"?>
<library xmlns="urn:hl7-org:elm:r1" xmlns:t="urn:hl7-org:elm-types:r1" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:fhir="http://hl7.org/fhir" xmlns:qdm43="urn:healthit-gov:qdm:v4_3" xmlns:qdm53="urn:healthit-gov:qdm:v5_3" xmlns:a="urn:hl7-org:cql-annotations:r1">
   <annotation translatorVersion="1.3" translatorOptions="EnableAnnotations,EnableLocators,DisableListDemotion,DisableListPromotion" xsi:type="a:CqlToElmInfo"/>
   <annotation xsi:type="a:Annotation">
      <a:s r="847">
         <a:s>library OMTKLogic version '3.0.0'</a:s>
      </a:s>
   </annotation>
   <identifier id="OMTKLogic" system="http://fhir.org/guides/cdc/opioid-mme-r4" version="3.0.0"/>
   <schemaIdentifier id="urn:hl7-org:elm" version="r1"/>
   <usings>
      <def localIdentifier="System" uri="urn:hl7-org:elm-types:r1"/>
   </usings>
   <includes>
      <def localId="1" locator="40:1-40:48" localIdentifier="OMTKData" path="http://fhir.org/guides/cdc/opioid-mme-r4/OMTKData" version="3.0.0">
         <annotation xsi:type="a:Annotation">
            <a:s r="1">
               <a:s>/*
This library provides functionality for calculating Morphine Milligram
Equivalents (MME) for opioid medications, as described in the CDC Opioid
Prescribing Guideline.

The functionality in this library was developed based on the Java-based
implementation described [here](http://build.fhir.org/ig/cqframework/opioid-cds-r4/service-documentation.html#solution-component-3-core-logic-processing-java-class),
as well as the MME conversion calculation published as part of the CDC Opioid
Prescribing Guideline.

Note that the logic in this library (and specifically the conversion factors captured here)
are based on the 2016 version of the publication available from the CDC here:
https://www.cdc.gov/drugoverdose/modules/data-files.html

National Center for Injury Prevention and Control. CDC compilation of benzodiazepines,
muscle relaxants, stimulants, zolpidem, and opioid analgesics with oral morphine milligram
equivalent conversion factors, 2018 version. Atlanta, GA: Centers for Disease Control
and Prevention; 2018. Available at https://www.cdc.gov/drugoverdose/resources/data.html

This version of the OMTKLogic library uses the OMTKData library as the
source for drug ingredient and strength information, rather than the
OMTK data source. This library has no external dependencies and so
can run in an environment that supports pure CQL.

NOTE: For performance, all terminology comparisons in this library use
direct integer comparison of the RxNorm codes.

This product uses publicly available data courtesy of the U.S. National Library of Medicine (NLM),
National Institutes of Health, Department of Health and Human Services; NLM is not responsible for
the product and does not endorse or recommend this or any other product.

Nelson SJ, Zeng K, Kilbourne J, Powell T, Moore R. Normalized names for clinical drugs: RxNorm at 6 years.
J Am Med Inform Assoc. 2011 Jul-Aug;18(4)441-8. doi: 10.1136/amiajnl-2011-000116.
Epub 2011 Apr 21. PubMed PMID: 21515544; PubMed Central PMCID: PMC3128404.
[Full text](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3128404/)
*/include </a:s>
               <a:s>
                  <a:s>OMTKData</a:s>
               </a:s>
               <a:s> version '3.0.0' called OMTKData</a:s>
            </a:s>
         </annotation>
      </def>
      <def localId="2" locator="41:1-41:66" localIdentifier="ConversionFactors" path="http://fhir.org/guides/cdc/opioid-mme-r4/ConversionFactors" version="3.0.0">
         <annotation xsi:type="a:Annotation">
            <a:s r="2">
               <a:s>include </a:s>
               <a:s>
                  <a:s>ConversionFactors</a:s>
               </a:s>
               <a:s> version '3.0.0' called ConversionFactors</a:s>
            </a:s>
         </annotation>
      </def>
   </includes>
   <parameters>
      <def localId="6" locator="45:1-45:45" name="ErrorLevel" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="6">
               <a:s>parameter ErrorLevel </a:s>
               <a:s r="5">
                  <a:s>String</a:s>
               </a:s>
               <a:s> default </a:s>
               <a:s r="4">
                  <a:s>'Warning'</a:s>
               </a:s>
            </a:s>
         </annotation>
         <default localId="4" locator="45:37-45:45" valueType="t:String" value="Warning" xsi:type="Literal"/>
         <parameterTypeSpecifier localId="5" locator="45:22-45:27" name="t:String" xsi:type="NamedTypeSpecifier"/>
      </def>
   </parameters>
   <codeSystems>
      <def localId="3" locator="43:1-43:66" name="RXNORM" id="http://www.nlm.nih.gov/research/umls/rxnorm" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="3">
               <a:s>codesystem &quot;RXNORM&quot;: 'http://www.nlm.nih.gov/research/umls/rxnorm'</a:s>
            </a:s>
         </annotation>
      </def>
   </codeSystems>
   <statements>
      <def localId="14" locator="47:1-52:3" name="Msg" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="14">
               <a:s>define function Msg(code </a:s>
               <a:s r="7">
                  <a:s>String</a:s>
               </a:s>
               <a:s>, errorLevel </a:s>
               <a:s r="8">
                  <a:s>String</a:s>
               </a:s>
               <a:s>, message </a:s>
               <a:s r="9">
                  <a:s>String</a:s>
               </a:s>
               <a:s>):
  </a:s>
               <a:s r="13">
                  <a:s r="13">
                     <a:s>{
    </a:s>
                     <a:s>
                        <a:s>code: </a:s>
                        <a:s r="10">
                           <a:s>code</a:s>
                        </a:s>
                     </a:s>
                     <a:s>,
    </a:s>
                     <a:s>
                        <a:s>errorLevel: </a:s>
                        <a:s r="11">
                           <a:s>errorLevel</a:s>
                        </a:s>
                     </a:s>
                     <a:s>,
    </a:s>
                     <a:s>
                        <a:s>message: </a:s>
                        <a:s r="12">
                           <a:s>message</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
  }</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="13" locator="48:3-52:3" xsi:type="Tuple">
            <element name="code">
               <value localId="10" locator="49:11-49:14" name="code" xsi:type="OperandRef"/>
            </element>
            <element name="errorLevel">
               <value localId="11" locator="50:17-50:26" name="errorLevel" xsi:type="OperandRef"/>
            </element>
            <element name="message">
               <value localId="12" locator="51:14-51:20" name="message" xsi:type="OperandRef"/>
            </element>
         </expression>
         <operand name="code">
            <operandTypeSpecifier localId="7" locator="47:26-47:31" name="t:String" xsi:type="NamedTypeSpecifier"/>
         </operand>
         <operand name="errorLevel">
            <operandTypeSpecifier localId="8" locator="47:45-47:50" name="t:String" xsi:type="NamedTypeSpecifier"/>
         </operand>
         <operand name="message">
            <operandTypeSpecifier localId="9" locator="47:61-47:66" name="t:String" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="38" locator="62:1-69:5" name="ToUCUM" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="38">
               <a:s>/*
Normalizes the input units to UCUM units

The values listed here are the only ones currently present in the OMTK data

Based on the HL7 UCUM subset here:
http://download.hl7.de/documents/ucum/ucumdata.html
*/define function ToUCUM(unit </a:s>
               <a:s r="15">
                  <a:s>String</a:s>
               </a:s>
               <a:s>):
  </a:s>
               <a:s r="37">
                  <a:s r="37">
                     <a:s>case </a:s>
                     <a:s r="16">
                        <a:s>unit</a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="19">
                        <a:s>when </a:s>
                        <a:s r="17">
                           <a:s>'MG'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="18">
                           <a:s>'mg'</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="22">
                        <a:s>when </a:s>
                        <a:s r="20">
                           <a:s>'MG/ACTUAT'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="21">
                           <a:s>'mg/{actuat}'</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="25">
                        <a:s>when </a:s>
                        <a:s r="23">
                           <a:s>'MG/HR'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="24">
                           <a:s>'mg/h'</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="28">
                        <a:s>when </a:s>
                        <a:s r="26">
                           <a:s>'MG/ML'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="27">
                           <a:s>'mg/mL'</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    else </a:s>
                     <a:s r="36">
                        <a:s r="29">Message(null, true, </a:s>
                        <a:s r="31">
                           <a:s>'OMTKLogic.ToUCUM.UnknownUnit'</a:s>
                        </a:s>
                        <a:s>, </a:s>
                        <a:s r="32">
                           <a:s>ErrorLevel</a:s>
                        </a:s>
                        <a:s>, </a:s>
                        <a:s r="35">
                           <a:s r="33">
                              <a:s>'Unknown unit '</a:s>
                           </a:s>
                           <a:s> &amp; </a:s>
                           <a:s r="34">
                              <a:s>unit</a:s>
                           </a:s>
                        </a:s>
                        <a:s>)</a:s>
                     </a:s>
                     <a:s>
  end</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="37" locator="63:3-69:5" xsi:type="Case">
            <comparand localId="16" locator="63:8-63:11" name="unit" xsi:type="OperandRef"/>
            <caseItem localId="19" locator="64:5-64:23">
               <when localId="17" locator="64:10-64:13" valueType="t:String" value="MG" xsi:type="Literal"/>
               <then localId="18" locator="64:20-64:23" valueType="t:String" value="mg" xsi:type="Literal"/>
            </caseItem>
            <caseItem localId="22" locator="65:5-65:39">
               <when localId="20" locator="65:10-65:20" valueType="t:String" value="MG/ACTUAT" xsi:type="Literal"/>
               <then localId="21" locator="65:27-65:39" valueType="t:String" value="mg/{actuat}" xsi:type="Literal"/>
            </caseItem>
            <caseItem localId="25" locator="66:5-66:28">
               <when localId="23" locator="66:10-66:16" valueType="t:String" value="MG/HR" xsi:type="Literal"/>
               <then localId="24" locator="66:23-66:28" valueType="t:String" value="mg/h" xsi:type="Literal"/>
            </caseItem>
            <caseItem localId="28" locator="67:5-67:29">
               <when localId="26" locator="67:10-67:16" valueType="t:String" value="MG/ML" xsi:type="Literal"/>
               <then localId="27" locator="67:23-67:29" valueType="t:String" value="mg/mL" xsi:type="Literal"/>
            </caseItem>
            <else asType="t:String" xsi:type="As">
               <operand localId="36" locator="68:10-68:96" xsi:type="Message">
                  <source localId="29" locator="68:18-68:21" xsi:type="Null"/>
                  <condition localId="30" locator="68:24-68:27" valueType="t:Boolean" value="true" xsi:type="Literal"/>
                  <code localId="31" locator="68:30-68:59" valueType="t:String" value="OMTKLogic.ToUCUM.UnknownUnit" xsi:type="Literal"/>
                  <severity localId="32" locator="68:62-68:71" name="ErrorLevel" xsi:type="ParameterRef"/>
                  <message localId="35" locator="68:74-68:95" xsi:type="Concatenate">
                     <operand xsi:type="Coalesce">
                        <operand localId="33" locator="68:74-68:88" valueType="t:String" value="Unknown unit " xsi:type="Literal"/>
                        <operand valueType="t:String" value="" xsi:type="Literal"/>
                     </operand>
                     <operand xsi:type="Coalesce">
                        <operand localId="34" locator="68:92-68:95" name="unit" xsi:type="OperandRef"/>
                        <operand valueType="t:String" value="" xsi:type="Literal"/>
                     </operand>
                  </message>
               </operand>
            </else>
         </expression>
         <operand name="unit">
            <operandTypeSpecifier localId="15" locator="62:29-62:34" name="t:String" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="59" locator="71:1-81:5" name="ToUCUM_Msg" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="59">
               <a:s>define function ToUCUM_Msg(unit </a:s>
               <a:s r="39">
                  <a:s>String</a:s>
               </a:s>
               <a:s>):
  </a:s>
               <a:s r="58">
                  <a:s r="58">
                     <a:s>
                        <a:s r="41">
                           <a:s r="40">
                              <a:s>
                                 <a:s>unit</a:s>
                              </a:s>
                           </a:s>
                           <a:s> U</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s>
                        <a:s>let </a:s>
                        <a:s r="44">
                           <a:s>result: </a:s>
                           <a:s r="43">
                              <a:s>ToUCUM(</a:s>
                              <a:s r="42">
                                 <a:s>U</a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="57">
                        <a:s>return </a:s>
                        <a:s r="56">
                           <a:s>{
      </a:s>
                           <a:s>
                              <a:s>result: </a:s>
                              <a:s r="45">
                                 <a:s>result</a:s>
                              </a:s>
                           </a:s>
                           <a:s>,
      </a:s>
                           <a:s>
                              <a:s>message:
        </a:s>
                              <a:s r="55">
                                 <a:s>if </a:s>
                                 <a:s r="47">
                                    <a:s r="46">
                                       <a:s>result</a:s>
                                    </a:s>
                                    <a:s> is null</a:s>
                                 </a:s>
                                 <a:s> then
          </a:s>
                                 <a:s r="53">
                                    <a:s>Msg(</a:s>
                                    <a:s r="48">
                                       <a:s>'OMTKLogic.ToUCUM.UnknownUnit'</a:s>
                                    </a:s>
                                    <a:s>, </a:s>
                                    <a:s r="49">
                                       <a:s>ErrorLevel</a:s>
                                    </a:s>
                                    <a:s>, </a:s>
                                    <a:s r="52">
                                       <a:s r="50">
                                          <a:s>'Unknown unit'</a:s>
                                       </a:s>
                                       <a:s> &amp; </a:s>
                                       <a:s r="51">
                                          <a:s>unit</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>)</a:s>
                                 </a:s>
                                 <a:s r="54">
        else
          null</a:s>
                              </a:s>
                           </a:s>
                           <a:s>
    }</a:s>
                        </a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="58" locator="72:3-81:5" xsi:type="Query">
            <source localId="41" locator="72:3-72:8" alias="U">
               <expression localId="40" locator="72:3-72:6" name="unit" xsi:type="OperandRef"/>
            </source>
            <let localId="44" locator="73:9-73:25" identifier="result">
               <expression localId="43" locator="73:17-73:25" name="ToUCUM" xsi:type="FunctionRef">
                  <operand localId="42" locator="73:24" name="U" xsi:type="AliasRef"/>
               </expression>
            </let>
            <return localId="57" locator="74:5-81:5">
               <expression localId="56" locator="74:12-81:5" xsi:type="Tuple">
                  <element name="result">
                     <value localId="45" locator="75:15-75:20" name="result" xsi:type="QueryLetRef"/>
                  </element>
                  <element name="message">
                     <value localId="55" locator="77:9-80:14" xsi:type="If">
                        <condition localId="47" locator="77:12-77:25" xsi:type="IsNull">
                           <operand localId="46" locator="77:12-77:17" name="result" xsi:type="QueryLetRef"/>
                        </condition>
                        <then localId="53" locator="78:11-78:80" name="Msg" xsi:type="FunctionRef">
                           <operand localId="48" locator="78:15-78:44" valueType="t:String" value="OMTKLogic.ToUCUM.UnknownUnit" xsi:type="Literal"/>
                           <operand localId="49" locator="78:47-78:56" name="ErrorLevel" xsi:type="ParameterRef"/>
                           <operand localId="52" locator="78:59-78:79" xsi:type="Concatenate">
                              <operand xsi:type="Coalesce">
                                 <operand localId="50" locator="78:59-78:72" valueType="t:String" value="Unknown unit" xsi:type="Literal"/>
                                 <operand valueType="t:String" value="" xsi:type="Literal"/>
                              </operand>
                              <operand xsi:type="Coalesce">
                                 <operand localId="51" locator="78:76-78:79" name="unit" xsi:type="OperandRef"/>
                                 <operand valueType="t:String" value="" xsi:type="Literal"/>
                              </operand>
                           </operand>
                        </then>
                        <else xsi:type="As">
                           <operand localId="54" locator="80:11-80:14" xsi:type="Null"/>
                           <asTypeSpecifier xsi:type="TupleTypeSpecifier">
                              <element name="code">
                                 <elementType name="t:String" xsi:type="NamedTypeSpecifier"/>
                              </element>
                              <element name="errorLevel">
                                 <elementType name="t:String" xsi:type="NamedTypeSpecifier"/>
                              </element>
                              <element name="message">
                                 <elementType name="t:String" xsi:type="NamedTypeSpecifier"/>
                              </element>
                           </asTypeSpecifier>
                        </else>
                     </value>
                  </element>
               </expression>
            </return>
         </expression>
         <operand name="unit">
            <operandTypeSpecifier localId="39" locator="71:33-71:38" name="t:String" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="302" locator="86:1-110:5" name="ToDaily" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="302">
               <a:s>/*
  Calculates daily frequency given frequency within a period
*/define function ToDaily(frequency </a:s>
               <a:s r="60">
                  <a:s>Integer</a:s>
               </a:s>
               <a:s>, period </a:s>
               <a:s r="61">
                  <a:s>Quantity</a:s>
               </a:s>
               <a:s>):
  </a:s>
               <a:s r="301">
                  <a:s r="301">
                     <a:s>case </a:s>
                     <a:s r="63">
                        <a:s r="62">
                           <a:s>period</a:s>
                        </a:s>
                        <a:s>.</a:s>
                        <a:s r="63">
                           <a:s>unit</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="71">
                        <a:s>when </a:s>
                        <a:s r="64">
                           <a:s>'h'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="70">
                           <a:s r="65">
                              <a:s>frequency</a:s>
                           </a:s>
                           <a:s> * </a:s>
                           <a:s r="69">
                              <a:s>(</a:s>
                              <a:s r="69">
                                 <a:s r="66">24.0 / </a:s>
                                 <a:s r="68">
                                    <a:s r="67">
                                       <a:s>period</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="68">
                                       <a:s>value</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="81">
                        <a:s>when </a:s>
                        <a:s r="72">
                           <a:s>'min'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="80">
                           <a:s r="78">
                              <a:s r="73">
                                 <a:s>frequency</a:s>
                              </a:s>
                              <a:s> * </a:s>
                              <a:s r="77">
                                 <a:s>(</a:s>
                                 <a:s r="77">
                                    <a:s r="74">24.0 / </a:s>
                                    <a:s r="76">
                                       <a:s r="75">
                                          <a:s>period</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="76">
                                          <a:s>value</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                           </a:s>
                           <a:s r="79"> * 60</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="93">
                        <a:s>when </a:s>
                        <a:s r="82">
                           <a:s>'s'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="92">
                           <a:s r="90">
                              <a:s r="88">
                                 <a:s r="83">
                                    <a:s>frequency</a:s>
                                 </a:s>
                                 <a:s> * </a:s>
                                 <a:s r="87">
                                    <a:s>(</a:s>
                                    <a:s r="87">
                                       <a:s r="84">24.0 / </a:s>
                                       <a:s r="86">
                                          <a:s r="85">
                                             <a:s>period</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="86">
                                             <a:s>value</a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>)</a:s>
                                 </a:s>
                              </a:s>
                              <a:s r="89"> * 60</a:s>
                           </a:s>
                           <a:s r="91"> * 60</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="103">
                        <a:s>when </a:s>
                        <a:s r="94">
                           <a:s>'d'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="102">
                           <a:s r="100">
                              <a:s r="95">
                                 <a:s>frequency</a:s>
                              </a:s>
                              <a:s> * </a:s>
                              <a:s r="99">
                                 <a:s>(</a:s>
                                 <a:s r="99">
                                    <a:s r="96">24.0 / </a:s>
                                    <a:s r="98">
                                       <a:s r="97">
                                          <a:s>period</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="98">
                                          <a:s>value</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                           </a:s>
                           <a:s r="101"> / 24</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="115">
                        <a:s>when </a:s>
                        <a:s r="104">
                           <a:s>'wk'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="114">
                           <a:s r="110">
                              <a:s r="105">
                                 <a:s>frequency</a:s>
                              </a:s>
                              <a:s> * </a:s>
                              <a:s r="109">
                                 <a:s>(</a:s>
                                 <a:s r="109">
                                    <a:s r="106">24.0 / </a:s>
                                    <a:s r="108">
                                       <a:s r="107">
                                          <a:s>period</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="108">
                                          <a:s>value</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                           </a:s>
                           <a:s> / </a:s>
                           <a:s r="113">
                              <a:s>(</a:s>
                              <a:s r="113">
                                 <a:s r="111">24 * 7</a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="127">
                        <a:s>when </a:s>
                        <a:s r="116">
                           <a:s>'mo'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="126">
                           <a:s r="122">
                              <a:s r="117">
                                 <a:s>frequency</a:s>
                              </a:s>
                              <a:s> * </a:s>
                              <a:s r="121">
                                 <a:s>(</a:s>
                                 <a:s r="121">
                                    <a:s r="118">24.0 / </a:s>
                                    <a:s r="120">
                                       <a:s r="119">
                                          <a:s>period</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="120">
                                          <a:s>value</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                           </a:s>
                           <a:s> / </a:s>
                           <a:s r="125">
                              <a:s>(</a:s>
                              <a:s r="125">
                                 <a:s r="123">24 * 30</a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s> /* assuming 30 days in month */
    </a:s>
                     <a:s r="139">
                        <a:s>when </a:s>
                        <a:s r="128">
                           <a:s>'a'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="138">
                           <a:s r="134">
                              <a:s r="129">
                                 <a:s>frequency</a:s>
                              </a:s>
                              <a:s> * </a:s>
                              <a:s r="133">
                                 <a:s>(</a:s>
                                 <a:s r="133">
                                    <a:s r="130">24.0 / </a:s>
                                    <a:s r="132">
                                       <a:s r="131">
                                          <a:s>period</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="132">
                                          <a:s>value</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                           </a:s>
                           <a:s> / </a:s>
                           <a:s r="137">
                              <a:s>(</a:s>
                              <a:s r="137">
                                 <a:s r="135">24 * 365</a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s> /* assuming 365 days in year */
    </a:s>
                     <a:s r="147">
                        <a:s>when </a:s>
                        <a:s r="140">
                           <a:s>'hour'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="146">
                           <a:s r="141">
                              <a:s>frequency</a:s>
                           </a:s>
                           <a:s> * </a:s>
                           <a:s r="145">
                              <a:s>(</a:s>
                              <a:s r="145">
                                 <a:s r="142">24.0 / </a:s>
                                 <a:s r="144">
                                    <a:s r="143">
                                       <a:s>period</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="144">
                                       <a:s>value</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="157">
                        <a:s>when </a:s>
                        <a:s r="148">
                           <a:s>'minute'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="156">
                           <a:s r="154">
                              <a:s r="149">
                                 <a:s>frequency</a:s>
                              </a:s>
                              <a:s> * </a:s>
                              <a:s r="153">
                                 <a:s>(</a:s>
                                 <a:s r="153">
                                    <a:s r="150">24.0 / </a:s>
                                    <a:s r="152">
                                       <a:s r="151">
                                          <a:s>period</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="152">
                                          <a:s>value</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                           </a:s>
                           <a:s r="155"> * 60</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="169">
                        <a:s>when </a:s>
                        <a:s r="158">
                           <a:s>'second'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="168">
                           <a:s r="166">
                              <a:s r="164">
                                 <a:s r="159">
                                    <a:s>frequency</a:s>
                                 </a:s>
                                 <a:s> * </a:s>
                                 <a:s r="163">
                                    <a:s>(</a:s>
                                    <a:s r="163">
                                       <a:s r="160">24.0 / </a:s>
                                       <a:s r="162">
                                          <a:s r="161">
                                             <a:s>period</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="162">
                                             <a:s>value</a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>)</a:s>
                                 </a:s>
                              </a:s>
                              <a:s r="165"> * 60</a:s>
                           </a:s>
                           <a:s r="167"> * 60</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="179">
                        <a:s>when </a:s>
                        <a:s r="170">
                           <a:s>'day'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="178">
                           <a:s r="176">
                              <a:s r="171">
                                 <a:s>frequency</a:s>
                              </a:s>
                              <a:s> * </a:s>
                              <a:s r="175">
                                 <a:s>(</a:s>
                                 <a:s r="175">
                                    <a:s r="172">24.0 / </a:s>
                                    <a:s r="174">
                                       <a:s r="173">
                                          <a:s>period</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="174">
                                          <a:s>value</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                           </a:s>
                           <a:s r="177"> / 24</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="191">
                        <a:s>when </a:s>
                        <a:s r="180">
                           <a:s>'week'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="190">
                           <a:s r="186">
                              <a:s r="181">
                                 <a:s>frequency</a:s>
                              </a:s>
                              <a:s> * </a:s>
                              <a:s r="185">
                                 <a:s>(</a:s>
                                 <a:s r="185">
                                    <a:s r="182">24.0 / </a:s>
                                    <a:s r="184">
                                       <a:s r="183">
                                          <a:s>period</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="184">
                                          <a:s>value</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                           </a:s>
                           <a:s> / </a:s>
                           <a:s r="189">
                              <a:s>(</a:s>
                              <a:s r="189">
                                 <a:s r="187">24 * 7</a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="203">
                        <a:s>when </a:s>
                        <a:s r="192">
                           <a:s>'month'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="202">
                           <a:s r="198">
                              <a:s r="193">
                                 <a:s>frequency</a:s>
                              </a:s>
                              <a:s> * </a:s>
                              <a:s r="197">
                                 <a:s>(</a:s>
                                 <a:s r="197">
                                    <a:s r="194">24.0 / </a:s>
                                    <a:s r="196">
                                       <a:s r="195">
                                          <a:s>period</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="196">
                                          <a:s>value</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                           </a:s>
                           <a:s> / </a:s>
                           <a:s r="201">
                              <a:s>(</a:s>
                              <a:s r="201">
                                 <a:s r="199">24 * 30</a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s> /* assuming 30 days in month */
    </a:s>
                     <a:s r="215">
                        <a:s>when </a:s>
                        <a:s r="204">
                           <a:s>'year'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="214">
                           <a:s r="210">
                              <a:s r="205">
                                 <a:s>frequency</a:s>
                              </a:s>
                              <a:s> * </a:s>
                              <a:s r="209">
                                 <a:s>(</a:s>
                                 <a:s r="209">
                                    <a:s r="206">24.0 / </a:s>
                                    <a:s r="208">
                                       <a:s r="207">
                                          <a:s>period</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="208">
                                          <a:s>value</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                           </a:s>
                           <a:s> / </a:s>
                           <a:s r="213">
                              <a:s>(</a:s>
                              <a:s r="213">
                                 <a:s r="211">24 * 365</a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s> /* assuming 365 days in year */
    </a:s>
                     <a:s r="223">
                        <a:s>when </a:s>
                        <a:s r="216">
                           <a:s>'hours'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="222">
                           <a:s r="217">
                              <a:s>frequency</a:s>
                           </a:s>
                           <a:s> * </a:s>
                           <a:s r="221">
                              <a:s>(</a:s>
                              <a:s r="221">
                                 <a:s r="218">24.0 / </a:s>
                                 <a:s r="220">
                                    <a:s r="219">
                                       <a:s>period</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="220">
                                       <a:s>value</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="233">
                        <a:s>when </a:s>
                        <a:s r="224">
                           <a:s>'minutes'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="232">
                           <a:s r="230">
                              <a:s r="225">
                                 <a:s>frequency</a:s>
                              </a:s>
                              <a:s> * </a:s>
                              <a:s r="229">
                                 <a:s>(</a:s>
                                 <a:s r="229">
                                    <a:s r="226">24.0 / </a:s>
                                    <a:s r="228">
                                       <a:s r="227">
                                          <a:s>period</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="228">
                                          <a:s>value</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                           </a:s>
                           <a:s r="231"> * 60</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="245">
                        <a:s>when </a:s>
                        <a:s r="234">
                           <a:s>'seconds'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="244">
                           <a:s r="242">
                              <a:s r="240">
                                 <a:s r="235">
                                    <a:s>frequency</a:s>
                                 </a:s>
                                 <a:s> * </a:s>
                                 <a:s r="239">
                                    <a:s>(</a:s>
                                    <a:s r="239">
                                       <a:s r="236">24.0 / </a:s>
                                       <a:s r="238">
                                          <a:s r="237">
                                             <a:s>period</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="238">
                                             <a:s>value</a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>)</a:s>
                                 </a:s>
                              </a:s>
                              <a:s r="241"> * 60</a:s>
                           </a:s>
                           <a:s r="243"> * 60</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="255">
                        <a:s>when </a:s>
                        <a:s r="246">
                           <a:s>'days'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="254">
                           <a:s r="252">
                              <a:s r="247">
                                 <a:s>frequency</a:s>
                              </a:s>
                              <a:s> * </a:s>
                              <a:s r="251">
                                 <a:s>(</a:s>
                                 <a:s r="251">
                                    <a:s r="248">24.0 / </a:s>
                                    <a:s r="250">
                                       <a:s r="249">
                                          <a:s>period</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="250">
                                          <a:s>value</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                           </a:s>
                           <a:s r="253"> / 24</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="267">
                        <a:s>when </a:s>
                        <a:s r="256">
                           <a:s>'weeks'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="266">
                           <a:s r="262">
                              <a:s r="257">
                                 <a:s>frequency</a:s>
                              </a:s>
                              <a:s> * </a:s>
                              <a:s r="261">
                                 <a:s>(</a:s>
                                 <a:s r="261">
                                    <a:s r="258">24.0 / </a:s>
                                    <a:s r="260">
                                       <a:s r="259">
                                          <a:s>period</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="260">
                                          <a:s>value</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                           </a:s>
                           <a:s> / </a:s>
                           <a:s r="265">
                              <a:s>(</a:s>
                              <a:s r="265">
                                 <a:s r="263">24 * 7</a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="279">
                        <a:s>when </a:s>
                        <a:s r="268">
                           <a:s>'months'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="278">
                           <a:s r="274">
                              <a:s r="269">
                                 <a:s>frequency</a:s>
                              </a:s>
                              <a:s> * </a:s>
                              <a:s r="273">
                                 <a:s>(</a:s>
                                 <a:s r="273">
                                    <a:s r="270">24.0 / </a:s>
                                    <a:s r="272">
                                       <a:s r="271">
                                          <a:s>period</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="272">
                                          <a:s>value</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                           </a:s>
                           <a:s> / </a:s>
                           <a:s r="277">
                              <a:s>(</a:s>
                              <a:s r="277">
                                 <a:s r="275">24 * 30</a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s> /* assuming 30 days in month */
    </a:s>
                     <a:s r="291">
                        <a:s>when </a:s>
                        <a:s r="280">
                           <a:s>'years'</a:s>
                        </a:s>
                        <a:s> then </a:s>
                        <a:s r="290">
                           <a:s r="286">
                              <a:s r="281">
                                 <a:s>frequency</a:s>
                              </a:s>
                              <a:s> * </a:s>
                              <a:s r="285">
                                 <a:s>(</a:s>
                                 <a:s r="285">
                                    <a:s r="282">24.0 / </a:s>
                                    <a:s r="284">
                                       <a:s r="283">
                                          <a:s>period</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="284">
                                          <a:s>value</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                           </a:s>
                           <a:s> / </a:s>
                           <a:s r="289">
                              <a:s>(</a:s>
                              <a:s r="289">
                                 <a:s r="287">24 * 365</a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s> /* assuming 365 days in year */
    else </a:s>
                     <a:s r="300">
                        <a:s r="292">Message(null, true, </a:s>
                        <a:s r="294">
                           <a:s>'OMTKLogic.ToDaily.UnknownUnit'</a:s>
                        </a:s>
                        <a:s>, </a:s>
                        <a:s r="295">
                           <a:s>ErrorLevel</a:s>
                        </a:s>
                        <a:s>, </a:s>
                        <a:s r="299">
                           <a:s r="296">
                              <a:s>'Unknown unit '</a:s>
                           </a:s>
                           <a:s> &amp; </a:s>
                           <a:s r="298">
                              <a:s r="297">
                                 <a:s>period</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="298">
                                 <a:s>unit</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>)</a:s>
                     </a:s>
                     <a:s>
  end</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="301" locator="87:3-110:5" xsi:type="Case">
            <comparand localId="63" locator="87:8-87:18" path="unit" xsi:type="Property">
               <source localId="62" locator="87:8-87:13" name="period" xsi:type="OperandRef"/>
            </comparand>
            <caseItem localId="71" locator="88:5-88:51">
               <when localId="64" locator="88:10-88:12" valueType="t:String" value="h" xsi:type="Literal"/>
               <then localId="70" locator="88:19-88:51" xsi:type="Multiply">
                  <operand xsi:type="ToDecimal">
                     <operand localId="65" locator="88:19-88:27" name="frequency" xsi:type="OperandRef"/>
                  </operand>
                  <operand localId="69" locator="88:31-88:51" xsi:type="Divide">
                     <operand localId="66" locator="88:32-88:35" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                     <operand localId="68" locator="88:39-88:50" path="value" xsi:type="Property">
                        <source localId="67" locator="88:39-88:44" name="period" xsi:type="OperandRef"/>
                     </operand>
                  </operand>
               </then>
            </caseItem>
            <caseItem localId="81" locator="89:5-89:58">
               <when localId="72" locator="89:10-89:14" valueType="t:String" value="min" xsi:type="Literal"/>
               <then localId="80" locator="89:21-89:58" xsi:type="Multiply">
                  <operand localId="78" locator="89:21-89:53" xsi:type="Multiply">
                     <operand xsi:type="ToDecimal">
                        <operand localId="73" locator="89:21-89:29" name="frequency" xsi:type="OperandRef"/>
                     </operand>
                     <operand localId="77" locator="89:33-89:53" xsi:type="Divide">
                        <operand localId="74" locator="89:34-89:37" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                        <operand localId="76" locator="89:41-89:52" path="value" xsi:type="Property">
                           <source localId="75" locator="89:41-89:46" name="period" xsi:type="OperandRef"/>
                        </operand>
                     </operand>
                  </operand>
                  <operand xsi:type="ToDecimal">
                     <operand localId="79" locator="89:57-89:58" valueType="t:Integer" value="60" xsi:type="Literal"/>
                  </operand>
               </then>
            </caseItem>
            <caseItem localId="93" locator="90:5-90:61">
               <when localId="82" locator="90:10-90:12" valueType="t:String" value="s" xsi:type="Literal"/>
               <then localId="92" locator="90:19-90:61" xsi:type="Multiply">
                  <operand localId="90" locator="90:19-90:56" xsi:type="Multiply">
                     <operand localId="88" locator="90:19-90:51" xsi:type="Multiply">
                        <operand xsi:type="ToDecimal">
                           <operand localId="83" locator="90:19-90:27" name="frequency" xsi:type="OperandRef"/>
                        </operand>
                        <operand localId="87" locator="90:31-90:51" xsi:type="Divide">
                           <operand localId="84" locator="90:32-90:35" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                           <operand localId="86" locator="90:39-90:50" path="value" xsi:type="Property">
                              <source localId="85" locator="90:39-90:44" name="period" xsi:type="OperandRef"/>
                           </operand>
                        </operand>
                     </operand>
                     <operand xsi:type="ToDecimal">
                        <operand localId="89" locator="90:55-90:56" valueType="t:Integer" value="60" xsi:type="Literal"/>
                     </operand>
                  </operand>
                  <operand xsi:type="ToDecimal">
                     <operand localId="91" locator="90:60-90:61" valueType="t:Integer" value="60" xsi:type="Literal"/>
                  </operand>
               </then>
            </caseItem>
            <caseItem localId="103" locator="91:5-91:56">
               <when localId="94" locator="91:10-91:12" valueType="t:String" value="d" xsi:type="Literal"/>
               <then localId="102" locator="91:19-91:56" xsi:type="Divide">
                  <operand localId="100" locator="91:19-91:51" xsi:type="Multiply">
                     <operand xsi:type="ToDecimal">
                        <operand localId="95" locator="91:19-91:27" name="frequency" xsi:type="OperandRef"/>
                     </operand>
                     <operand localId="99" locator="91:31-91:51" xsi:type="Divide">
                        <operand localId="96" locator="91:32-91:35" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                        <operand localId="98" locator="91:39-91:50" path="value" xsi:type="Property">
                           <source localId="97" locator="91:39-91:44" name="period" xsi:type="OperandRef"/>
                        </operand>
                     </operand>
                  </operand>
                  <operand xsi:type="ToDecimal">
                     <operand localId="101" locator="91:55-91:56" valueType="t:Integer" value="24" xsi:type="Literal"/>
                  </operand>
               </then>
            </caseItem>
            <caseItem localId="115" locator="92:5-92:63">
               <when localId="104" locator="92:10-92:13" valueType="t:String" value="wk" xsi:type="Literal"/>
               <then localId="114" locator="92:20-92:63" xsi:type="Divide">
                  <operand localId="110" locator="92:20-92:52" xsi:type="Multiply">
                     <operand xsi:type="ToDecimal">
                        <operand localId="105" locator="92:20-92:28" name="frequency" xsi:type="OperandRef"/>
                     </operand>
                     <operand localId="109" locator="92:32-92:52" xsi:type="Divide">
                        <operand localId="106" locator="92:33-92:36" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                        <operand localId="108" locator="92:40-92:51" path="value" xsi:type="Property">
                           <source localId="107" locator="92:40-92:45" name="period" xsi:type="OperandRef"/>
                        </operand>
                     </operand>
                  </operand>
                  <operand xsi:type="ToDecimal">
                     <operand localId="113" locator="92:56-92:63" xsi:type="Multiply">
                        <operand localId="111" locator="92:57-92:58" valueType="t:Integer" value="24" xsi:type="Literal"/>
                        <operand localId="112" locator="92:62" valueType="t:Integer" value="7" xsi:type="Literal"/>
                     </operand>
                  </operand>
               </then>
            </caseItem>
            <caseItem localId="127" locator="93:5-93:64">
               <when localId="116" locator="93:10-93:13" valueType="t:String" value="mo" xsi:type="Literal"/>
               <then localId="126" locator="93:20-93:64" xsi:type="Divide">
                  <operand localId="122" locator="93:20-93:52" xsi:type="Multiply">
                     <operand xsi:type="ToDecimal">
                        <operand localId="117" locator="93:20-93:28" name="frequency" xsi:type="OperandRef"/>
                     </operand>
                     <operand localId="121" locator="93:32-93:52" xsi:type="Divide">
                        <operand localId="118" locator="93:33-93:36" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                        <operand localId="120" locator="93:40-93:51" path="value" xsi:type="Property">
                           <source localId="119" locator="93:40-93:45" name="period" xsi:type="OperandRef"/>
                        </operand>
                     </operand>
                  </operand>
                  <operand xsi:type="ToDecimal">
                     <operand localId="125" locator="93:56-93:64" xsi:type="Multiply">
                        <operand localId="123" locator="93:57-93:58" valueType="t:Integer" value="24" xsi:type="Literal"/>
                        <operand localId="124" locator="93:62-93:63" valueType="t:Integer" value="30" xsi:type="Literal"/>
                     </operand>
                  </operand>
               </then>
            </caseItem>
            <caseItem localId="139" locator="94:5-94:64">
               <when localId="128" locator="94:10-94:12" valueType="t:String" value="a" xsi:type="Literal"/>
               <then localId="138" locator="94:19-94:64" xsi:type="Divide">
                  <operand localId="134" locator="94:19-94:51" xsi:type="Multiply">
                     <operand xsi:type="ToDecimal">
                        <operand localId="129" locator="94:19-94:27" name="frequency" xsi:type="OperandRef"/>
                     </operand>
                     <operand localId="133" locator="94:31-94:51" xsi:type="Divide">
                        <operand localId="130" locator="94:32-94:35" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                        <operand localId="132" locator="94:39-94:50" path="value" xsi:type="Property">
                           <source localId="131" locator="94:39-94:44" name="period" xsi:type="OperandRef"/>
                        </operand>
                     </operand>
                  </operand>
                  <operand xsi:type="ToDecimal">
                     <operand localId="137" locator="94:55-94:64" xsi:type="Multiply">
                        <operand localId="135" locator="94:56-94:57" valueType="t:Integer" value="24" xsi:type="Literal"/>
                        <operand localId="136" locator="94:61-94:63" valueType="t:Integer" value="365" xsi:type="Literal"/>
                     </operand>
                  </operand>
               </then>
            </caseItem>
            <caseItem localId="147" locator="95:5-95:54">
               <when localId="140" locator="95:10-95:15" valueType="t:String" value="hour" xsi:type="Literal"/>
               <then localId="146" locator="95:22-95:54" xsi:type="Multiply">
                  <operand xsi:type="ToDecimal">
                     <operand localId="141" locator="95:22-95:30" name="frequency" xsi:type="OperandRef"/>
                  </operand>
                  <operand localId="145" locator="95:34-95:54" xsi:type="Divide">
                     <operand localId="142" locator="95:35-95:38" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                     <operand localId="144" locator="95:42-95:53" path="value" xsi:type="Property">
                        <source localId="143" locator="95:42-95:47" name="period" xsi:type="OperandRef"/>
                     </operand>
                  </operand>
               </then>
            </caseItem>
            <caseItem localId="157" locator="96:5-96:61">
               <when localId="148" locator="96:10-96:17" valueType="t:String" value="minute" xsi:type="Literal"/>
               <then localId="156" locator="96:24-96:61" xsi:type="Multiply">
                  <operand localId="154" locator="96:24-96:56" xsi:type="Multiply">
                     <operand xsi:type="ToDecimal">
                        <operand localId="149" locator="96:24-96:32" name="frequency" xsi:type="OperandRef"/>
                     </operand>
                     <operand localId="153" locator="96:36-96:56" xsi:type="Divide">
                        <operand localId="150" locator="96:37-96:40" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                        <operand localId="152" locator="96:44-96:55" path="value" xsi:type="Property">
                           <source localId="151" locator="96:44-96:49" name="period" xsi:type="OperandRef"/>
                        </operand>
                     </operand>
                  </operand>
                  <operand xsi:type="ToDecimal">
                     <operand localId="155" locator="96:60-96:61" valueType="t:Integer" value="60" xsi:type="Literal"/>
                  </operand>
               </then>
            </caseItem>
            <caseItem localId="169" locator="97:5-97:66">
               <when localId="158" locator="97:10-97:17" valueType="t:String" value="second" xsi:type="Literal"/>
               <then localId="168" locator="97:24-97:66" xsi:type="Multiply">
                  <operand localId="166" locator="97:24-97:61" xsi:type="Multiply">
                     <operand localId="164" locator="97:24-97:56" xsi:type="Multiply">
                        <operand xsi:type="ToDecimal">
                           <operand localId="159" locator="97:24-97:32" name="frequency" xsi:type="OperandRef"/>
                        </operand>
                        <operand localId="163" locator="97:36-97:56" xsi:type="Divide">
                           <operand localId="160" locator="97:37-97:40" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                           <operand localId="162" locator="97:44-97:55" path="value" xsi:type="Property">
                              <source localId="161" locator="97:44-97:49" name="period" xsi:type="OperandRef"/>
                           </operand>
                        </operand>
                     </operand>
                     <operand xsi:type="ToDecimal">
                        <operand localId="165" locator="97:60-97:61" valueType="t:Integer" value="60" xsi:type="Literal"/>
                     </operand>
                  </operand>
                  <operand xsi:type="ToDecimal">
                     <operand localId="167" locator="97:65-97:66" valueType="t:Integer" value="60" xsi:type="Literal"/>
                  </operand>
               </then>
            </caseItem>
            <caseItem localId="179" locator="98:5-98:58">
               <when localId="170" locator="98:10-98:14" valueType="t:String" value="day" xsi:type="Literal"/>
               <then localId="178" locator="98:21-98:58" xsi:type="Divide">
                  <operand localId="176" locator="98:21-98:53" xsi:type="Multiply">
                     <operand xsi:type="ToDecimal">
                        <operand localId="171" locator="98:21-98:29" name="frequency" xsi:type="OperandRef"/>
                     </operand>
                     <operand localId="175" locator="98:33-98:53" xsi:type="Divide">
                        <operand localId="172" locator="98:34-98:37" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                        <operand localId="174" locator="98:41-98:52" path="value" xsi:type="Property">
                           <source localId="173" locator="98:41-98:46" name="period" xsi:type="OperandRef"/>
                        </operand>
                     </operand>
                  </operand>
                  <operand xsi:type="ToDecimal">
                     <operand localId="177" locator="98:57-98:58" valueType="t:Integer" value="24" xsi:type="Literal"/>
                  </operand>
               </then>
            </caseItem>
            <caseItem localId="191" locator="99:5-99:65">
               <when localId="180" locator="99:10-99:15" valueType="t:String" value="week" xsi:type="Literal"/>
               <then localId="190" locator="99:22-99:65" xsi:type="Divide">
                  <operand localId="186" locator="99:22-99:54" xsi:type="Multiply">
                     <operand xsi:type="ToDecimal">
                        <operand localId="181" locator="99:22-99:30" name="frequency" xsi:type="OperandRef"/>
                     </operand>
                     <operand localId="185" locator="99:34-99:54" xsi:type="Divide">
                        <operand localId="182" locator="99:35-99:38" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                        <operand localId="184" locator="99:42-99:53" path="value" xsi:type="Property">
                           <source localId="183" locator="99:42-99:47" name="period" xsi:type="OperandRef"/>
                        </operand>
                     </operand>
                  </operand>
                  <operand xsi:type="ToDecimal">
                     <operand localId="189" locator="99:58-99:65" xsi:type="Multiply">
                        <operand localId="187" locator="99:59-99:60" valueType="t:Integer" value="24" xsi:type="Literal"/>
                        <operand localId="188" locator="99:64" valueType="t:Integer" value="7" xsi:type="Literal"/>
                     </operand>
                  </operand>
               </then>
            </caseItem>
            <caseItem localId="203" locator="100:5-100:67">
               <when localId="192" locator="100:10-100:16" valueType="t:String" value="month" xsi:type="Literal"/>
               <then localId="202" locator="100:23-100:67" xsi:type="Divide">
                  <operand localId="198" locator="100:23-100:55" xsi:type="Multiply">
                     <operand xsi:type="ToDecimal">
                        <operand localId="193" locator="100:23-100:31" name="frequency" xsi:type="OperandRef"/>
                     </operand>
                     <operand localId="197" locator="100:35-100:55" xsi:type="Divide">
                        <operand localId="194" locator="100:36-100:39" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                        <operand localId="196" locator="100:43-100:54" path="value" xsi:type="Property">
                           <source localId="195" locator="100:43-100:48" name="period" xsi:type="OperandRef"/>
                        </operand>
                     </operand>
                  </operand>
                  <operand xsi:type="ToDecimal">
                     <operand localId="201" locator="100:59-100:67" xsi:type="Multiply">
                        <operand localId="199" locator="100:60-100:61" valueType="t:Integer" value="24" xsi:type="Literal"/>
                        <operand localId="200" locator="100:65-100:66" valueType="t:Integer" value="30" xsi:type="Literal"/>
                     </operand>
                  </operand>
               </then>
            </caseItem>
            <caseItem localId="215" locator="101:5-101:67">
               <when localId="204" locator="101:10-101:15" valueType="t:String" value="year" xsi:type="Literal"/>
               <then localId="214" locator="101:22-101:67" xsi:type="Divide">
                  <operand localId="210" locator="101:22-101:54" xsi:type="Multiply">
                     <operand xsi:type="ToDecimal">
                        <operand localId="205" locator="101:22-101:30" name="frequency" xsi:type="OperandRef"/>
                     </operand>
                     <operand localId="209" locator="101:34-101:54" xsi:type="Divide">
                        <operand localId="206" locator="101:35-101:38" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                        <operand localId="208" locator="101:42-101:53" path="value" xsi:type="Property">
                           <source localId="207" locator="101:42-101:47" name="period" xsi:type="OperandRef"/>
                        </operand>
                     </operand>
                  </operand>
                  <operand xsi:type="ToDecimal">
                     <operand localId="213" locator="101:58-101:67" xsi:type="Multiply">
                        <operand localId="211" locator="101:59-101:60" valueType="t:Integer" value="24" xsi:type="Literal"/>
                        <operand localId="212" locator="101:64-101:66" valueType="t:Integer" value="365" xsi:type="Literal"/>
                     </operand>
                  </operand>
               </then>
            </caseItem>
            <caseItem localId="223" locator="102:5-102:55">
               <when localId="216" locator="102:10-102:16" valueType="t:String" value="hours" xsi:type="Literal"/>
               <then localId="222" locator="102:23-102:55" xsi:type="Multiply">
                  <operand xsi:type="ToDecimal">
                     <operand localId="217" locator="102:23-102:31" name="frequency" xsi:type="OperandRef"/>
                  </operand>
                  <operand localId="221" locator="102:35-102:55" xsi:type="Divide">
                     <operand localId="218" locator="102:36-102:39" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                     <operand localId="220" locator="102:43-102:54" path="value" xsi:type="Property">
                        <source localId="219" locator="102:43-102:48" name="period" xsi:type="OperandRef"/>
                     </operand>
                  </operand>
               </then>
            </caseItem>
            <caseItem localId="233" locator="103:5-103:62">
               <when localId="224" locator="103:10-103:18" valueType="t:String" value="minutes" xsi:type="Literal"/>
               <then localId="232" locator="103:25-103:62" xsi:type="Multiply">
                  <operand localId="230" locator="103:25-103:57" xsi:type="Multiply">
                     <operand xsi:type="ToDecimal">
                        <operand localId="225" locator="103:25-103:33" name="frequency" xsi:type="OperandRef"/>
                     </operand>
                     <operand localId="229" locator="103:37-103:57" xsi:type="Divide">
                        <operand localId="226" locator="103:38-103:41" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                        <operand localId="228" locator="103:45-103:56" path="value" xsi:type="Property">
                           <source localId="227" locator="103:45-103:50" name="period" xsi:type="OperandRef"/>
                        </operand>
                     </operand>
                  </operand>
                  <operand xsi:type="ToDecimal">
                     <operand localId="231" locator="103:61-103:62" valueType="t:Integer" value="60" xsi:type="Literal"/>
                  </operand>
               </then>
            </caseItem>
            <caseItem localId="245" locator="104:5-104:67">
               <when localId="234" locator="104:10-104:18" valueType="t:String" value="seconds" xsi:type="Literal"/>
               <then localId="244" locator="104:25-104:67" xsi:type="Multiply">
                  <operand localId="242" locator="104:25-104:62" xsi:type="Multiply">
                     <operand localId="240" locator="104:25-104:57" xsi:type="Multiply">
                        <operand xsi:type="ToDecimal">
                           <operand localId="235" locator="104:25-104:33" name="frequency" xsi:type="OperandRef"/>
                        </operand>
                        <operand localId="239" locator="104:37-104:57" xsi:type="Divide">
                           <operand localId="236" locator="104:38-104:41" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                           <operand localId="238" locator="104:45-104:56" path="value" xsi:type="Property">
                              <source localId="237" locator="104:45-104:50" name="period" xsi:type="OperandRef"/>
                           </operand>
                        </operand>
                     </operand>
                     <operand xsi:type="ToDecimal">
                        <operand localId="241" locator="104:61-104:62" valueType="t:Integer" value="60" xsi:type="Literal"/>
                     </operand>
                  </operand>
                  <operand xsi:type="ToDecimal">
                     <operand localId="243" locator="104:66-104:67" valueType="t:Integer" value="60" xsi:type="Literal"/>
                  </operand>
               </then>
            </caseItem>
            <caseItem localId="255" locator="105:5-105:59">
               <when localId="246" locator="105:10-105:15" valueType="t:String" value="days" xsi:type="Literal"/>
               <then localId="254" locator="105:22-105:59" xsi:type="Divide">
                  <operand localId="252" locator="105:22-105:54" xsi:type="Multiply">
                     <operand xsi:type="ToDecimal">
                        <operand localId="247" locator="105:22-105:30" name="frequency" xsi:type="OperandRef"/>
                     </operand>
                     <operand localId="251" locator="105:34-105:54" xsi:type="Divide">
                        <operand localId="248" locator="105:35-105:38" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                        <operand localId="250" locator="105:42-105:53" path="value" xsi:type="Property">
                           <source localId="249" locator="105:42-105:47" name="period" xsi:type="OperandRef"/>
                        </operand>
                     </operand>
                  </operand>
                  <operand xsi:type="ToDecimal">
                     <operand localId="253" locator="105:58-105:59" valueType="t:Integer" value="24" xsi:type="Literal"/>
                  </operand>
               </then>
            </caseItem>
            <caseItem localId="267" locator="106:5-106:66">
               <when localId="256" locator="106:10-106:16" valueType="t:String" value="weeks" xsi:type="Literal"/>
               <then localId="266" locator="106:23-106:66" xsi:type="Divide">
                  <operand localId="262" locator="106:23-106:55" xsi:type="Multiply">
                     <operand xsi:type="ToDecimal">
                        <operand localId="257" locator="106:23-106:31" name="frequency" xsi:type="OperandRef"/>
                     </operand>
                     <operand localId="261" locator="106:35-106:55" xsi:type="Divide">
                        <operand localId="258" locator="106:36-106:39" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                        <operand localId="260" locator="106:43-106:54" path="value" xsi:type="Property">
                           <source localId="259" locator="106:43-106:48" name="period" xsi:type="OperandRef"/>
                        </operand>
                     </operand>
                  </operand>
                  <operand xsi:type="ToDecimal">
                     <operand localId="265" locator="106:59-106:66" xsi:type="Multiply">
                        <operand localId="263" locator="106:60-106:61" valueType="t:Integer" value="24" xsi:type="Literal"/>
                        <operand localId="264" locator="106:65" valueType="t:Integer" value="7" xsi:type="Literal"/>
                     </operand>
                  </operand>
               </then>
            </caseItem>
            <caseItem localId="279" locator="107:5-107:68">
               <when localId="268" locator="107:10-107:17" valueType="t:String" value="months" xsi:type="Literal"/>
               <then localId="278" locator="107:24-107:68" xsi:type="Divide">
                  <operand localId="274" locator="107:24-107:56" xsi:type="Multiply">
                     <operand xsi:type="ToDecimal">
                        <operand localId="269" locator="107:24-107:32" name="frequency" xsi:type="OperandRef"/>
                     </operand>
                     <operand localId="273" locator="107:36-107:56" xsi:type="Divide">
                        <operand localId="270" locator="107:37-107:40" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                        <operand localId="272" locator="107:44-107:55" path="value" xsi:type="Property">
                           <source localId="271" locator="107:44-107:49" name="period" xsi:type="OperandRef"/>
                        </operand>
                     </operand>
                  </operand>
                  <operand xsi:type="ToDecimal">
                     <operand localId="277" locator="107:60-107:68" xsi:type="Multiply">
                        <operand localId="275" locator="107:61-107:62" valueType="t:Integer" value="24" xsi:type="Literal"/>
                        <operand localId="276" locator="107:66-107:67" valueType="t:Integer" value="30" xsi:type="Literal"/>
                     </operand>
                  </operand>
               </then>
            </caseItem>
            <caseItem localId="291" locator="108:5-108:68">
               <when localId="280" locator="108:10-108:16" valueType="t:String" value="years" xsi:type="Literal"/>
               <then localId="290" locator="108:23-108:68" xsi:type="Divide">
                  <operand localId="286" locator="108:23-108:55" xsi:type="Multiply">
                     <operand xsi:type="ToDecimal">
                        <operand localId="281" locator="108:23-108:31" name="frequency" xsi:type="OperandRef"/>
                     </operand>
                     <operand localId="285" locator="108:35-108:55" xsi:type="Divide">
                        <operand localId="282" locator="108:36-108:39" valueType="t:Decimal" value="24.0" xsi:type="Literal"/>
                        <operand localId="284" locator="108:43-108:54" path="value" xsi:type="Property">
                           <source localId="283" locator="108:43-108:48" name="period" xsi:type="OperandRef"/>
                        </operand>
                     </operand>
                  </operand>
                  <operand xsi:type="ToDecimal">
                     <operand localId="289" locator="108:59-108:68" xsi:type="Multiply">
                        <operand localId="287" locator="108:60-108:61" valueType="t:Integer" value="24" xsi:type="Literal"/>
                        <operand localId="288" locator="108:65-108:67" valueType="t:Integer" value="365" xsi:type="Literal"/>
                     </operand>
                  </operand>
               </then>
            </caseItem>
            <else asType="t:Decimal" xsi:type="As">
               <operand localId="300" locator="109:10-109:104" xsi:type="Message">
                  <source localId="292" locator="109:18-109:21" xsi:type="Null"/>
                  <condition localId="293" locator="109:24-109:27" valueType="t:Boolean" value="true" xsi:type="Literal"/>
                  <code localId="294" locator="109:30-109:60" valueType="t:String" value="OMTKLogic.ToDaily.UnknownUnit" xsi:type="Literal"/>
                  <severity localId="295" locator="109:63-109:72" name="ErrorLevel" xsi:type="ParameterRef"/>
                  <message localId="299" locator="109:75-109:103" xsi:type="Concatenate">
                     <operand xsi:type="Coalesce">
                        <operand localId="296" locator="109:75-109:89" valueType="t:String" value="Unknown unit " xsi:type="Literal"/>
                        <operand valueType="t:String" value="" xsi:type="Literal"/>
                     </operand>
                     <operand xsi:type="Coalesce">
                        <operand localId="298" locator="109:93-109:103" path="unit" xsi:type="Property">
                           <source localId="297" locator="109:93-109:98" name="period" xsi:type="OperandRef"/>
                        </operand>
                        <operand valueType="t:String" value="" xsi:type="Literal"/>
                     </operand>
                  </message>
               </operand>
            </else>
         </expression>
         <operand name="frequency">
            <operandTypeSpecifier localId="60" locator="86:35-86:41" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
         </operand>
         <operand name="period">
            <operandTypeSpecifier localId="61" locator="86:51-86:58" name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="326" locator="112:1-122:5" name="ToDaily_Msg" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="326">
               <a:s>define function ToDaily_Msg(frequency </a:s>
               <a:s r="303">
                  <a:s>Integer</a:s>
               </a:s>
               <a:s>, period </a:s>
               <a:s r="304">
                  <a:s>Quantity</a:s>
               </a:s>
               <a:s>):
  </a:s>
               <a:s r="325">
                  <a:s r="325">
                     <a:s>
                        <a:s r="306">
                           <a:s r="305">
                              <a:s>
                                 <a:s>frequency</a:s>
                              </a:s>
                           </a:s>
                           <a:s> F</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s>
                        <a:s>let </a:s>
                        <a:s r="310">
                           <a:s>result: </a:s>
                           <a:s r="309">
                              <a:s>ToDaily(</a:s>
                              <a:s r="307">
                                 <a:s>frequency</a:s>
                              </a:s>
                              <a:s>, </a:s>
                              <a:s r="308">
                                 <a:s>period</a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="324">
                        <a:s>return </a:s>
                        <a:s r="323">
                           <a:s>{
      </a:s>
                           <a:s>
                              <a:s>result: </a:s>
                              <a:s r="311">
                                 <a:s>result</a:s>
                              </a:s>
                           </a:s>
                           <a:s>,
      </a:s>
                           <a:s>
                              <a:s>message:
        </a:s>
                              <a:s r="322">
                                 <a:s>if </a:s>
                                 <a:s r="313">
                                    <a:s r="312">
                                       <a:s>result</a:s>
                                    </a:s>
                                    <a:s> is null</a:s>
                                 </a:s>
                                 <a:s> then
          </a:s>
                                 <a:s r="320">
                                    <a:s>Msg(</a:s>
                                    <a:s r="314">
                                       <a:s>'OMTKLogic.ToDaily.UnknownUnit'</a:s>
                                    </a:s>
                                    <a:s>, </a:s>
                                    <a:s r="315">
                                       <a:s>ErrorLevel</a:s>
                                    </a:s>
                                    <a:s>, </a:s>
                                    <a:s r="319">
                                       <a:s r="316">
                                          <a:s>'Unknown unit '</a:s>
                                       </a:s>
                                       <a:s> &amp; </a:s>
                                       <a:s r="318">
                                          <a:s r="317">
                                             <a:s>period</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="318">
                                             <a:s>unit</a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>)</a:s>
                                 </a:s>
                                 <a:s r="321">
        else
          null</a:s>
                              </a:s>
                           </a:s>
                           <a:s>
    }</a:s>
                        </a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="325" locator="113:3-122:5" xsi:type="Query">
            <source localId="306" locator="113:3-113:13" alias="F">
               <expression localId="305" locator="113:3-113:11" name="frequency" xsi:type="OperandRef"/>
            </source>
            <let localId="310" locator="114:9-114:42" identifier="result">
               <expression localId="309" locator="114:17-114:42" name="ToDaily" xsi:type="FunctionRef">
                  <operand localId="307" locator="114:25-114:33" name="frequency" xsi:type="OperandRef"/>
                  <operand localId="308" locator="114:36-114:41" name="period" xsi:type="OperandRef"/>
               </expression>
            </let>
            <return localId="324" locator="115:5-122:5">
               <expression localId="323" locator="115:12-122:5" xsi:type="Tuple">
                  <element name="result">
                     <value localId="311" locator="116:15-116:20" name="result" xsi:type="QueryLetRef"/>
                  </element>
                  <element name="message">
                     <value localId="322" locator="118:9-121:14" xsi:type="If">
                        <condition localId="313" locator="118:12-118:25" xsi:type="IsNull">
                           <operand localId="312" locator="118:12-118:17" name="result" xsi:type="QueryLetRef"/>
                        </condition>
                        <then localId="320" locator="119:11-119:89" name="Msg" xsi:type="FunctionRef">
                           <operand localId="314" locator="119:15-119:45" valueType="t:String" value="OMTKLogic.ToDaily.UnknownUnit" xsi:type="Literal"/>
                           <operand localId="315" locator="119:48-119:57" name="ErrorLevel" xsi:type="ParameterRef"/>
                           <operand localId="319" locator="119:60-119:88" xsi:type="Concatenate">
                              <operand xsi:type="Coalesce">
                                 <operand localId="316" locator="119:60-119:74" valueType="t:String" value="Unknown unit " xsi:type="Literal"/>
                                 <operand valueType="t:String" value="" xsi:type="Literal"/>
                              </operand>
                              <operand xsi:type="Coalesce">
                                 <operand localId="318" locator="119:78-119:88" path="unit" xsi:type="Property">
                                    <source localId="317" locator="119:78-119:83" name="period" xsi:type="OperandRef"/>
                                 </operand>
                                 <operand valueType="t:String" value="" xsi:type="Literal"/>
                              </operand>
                           </operand>
                        </then>
                        <else xsi:type="As">
                           <operand localId="321" locator="121:11-121:14" xsi:type="Null"/>
                           <asTypeSpecifier xsi:type="TupleTypeSpecifier">
                              <element name="code">
                                 <elementType name="t:String" xsi:type="NamedTypeSpecifier"/>
                              </element>
                              <element name="errorLevel">
                                 <elementType name="t:String" xsi:type="NamedTypeSpecifier"/>
                              </element>
                              <element name="message">
                                 <elementType name="t:String" xsi:type="NamedTypeSpecifier"/>
                              </element>
                           </asTypeSpecifier>
                        </else>
                     </value>
                  </element>
               </expression>
            </return>
         </expression>
         <operand name="frequency">
            <operandTypeSpecifier localId="303" locator="112:39-112:45" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
         </operand>
         <operand name="period">
            <operandTypeSpecifier localId="304" locator="112:55-112:62" name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="366" locator="147:1-158:5" name="GetIngredients" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="366">
               <a:s>/*
Returns the opioid ingredients and their strengths that
make up the drug identified by the given rxNormCode as a list of tuples:

List&lt;Tuple {
  rxNormCode Code,
  doseFormCode Code,
  doseFormName String,
  ingredientCode Code,
  ingredientName String,
  strength Quantity
}>
*/

/*
GetIngredients:
  List&lt;{
    rxNormCode Code,
    doseFormCode Code,
    ingredientCode code,
    strength Quantity
  }>
*/define function GetIngredients(rxNormCode </a:s>
               <a:s r="327">
                  <a:s>Code</a:s>
               </a:s>
               <a:s>):
  </a:s>
               <a:s r="365">
                  <a:s r="365">
                     <a:s>
                        <a:s r="329">
                           <a:s r="328">
                              <a:s>
                                 <a:s>OMTKData.DrugIngredients</a:s>
                              </a:s>
                           </a:s>
                           <a:s> DI</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="335">
                        <a:s>where </a:s>
                        <a:s r="335">
                           <a:s r="331">
                              <a:s r="330">
                                 <a:s>DI</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="331">
                                 <a:s>drugCode</a:s>
                              </a:s>
                           </a:s>
                           <a:s> = </a:s>
                           <a:s r="334">
                              <a:s>ToInteger(</a:s>
                              <a:s r="333">
                                 <a:s r="332">
                                    <a:s>rxNormCode</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="333">
                                    <a:s>code</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="364">
                        <a:s>return </a:s>
                        <a:s r="363">
                           <a:s>{
      </a:s>
                           <a:s>
                              <a:s>rxNormCode: </a:s>
                              <a:s r="342">
                                 <a:s>Code { </a:s>
                                 <a:s>
                                    <a:s>code: </a:s>
                                    <a:s r="338">
                                       <a:s>ToString(</a:s>
                                       <a:s r="337">
                                          <a:s r="336">
                                             <a:s>DI</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="337">
                                             <a:s>drugCode</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>)</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>, </a:s>
                                 <a:s>
                                    <a:s>system: </a:s>
                                    <a:s r="339">
                                       <a:s>'http://www.nlm.nih.gov/research/umls/rxnorm'</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>, </a:s>
                                 <a:s>
                                    <a:s>display: </a:s>
                                    <a:s r="341">
                                       <a:s r="340">
                                          <a:s>DI</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="341">
                                          <a:s>drugName</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s> }</a:s>
                              </a:s>
                           </a:s>
                           <a:s>,
      </a:s>
                           <a:s>
                              <a:s>doseFormCode: </a:s>
                              <a:s r="349">
                                 <a:s>Code { </a:s>
                                 <a:s>
                                    <a:s>code: </a:s>
                                    <a:s r="345">
                                       <a:s>ToString(</a:s>
                                       <a:s r="344">
                                          <a:s r="343">
                                             <a:s>DI</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="344">
                                             <a:s>doseFormCode</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>)</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>, </a:s>
                                 <a:s>
                                    <a:s>system: </a:s>
                                    <a:s r="346">
                                       <a:s>'http://www.nlm.nih.gov/research/umls/rxnorm'</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>, </a:s>
                                 <a:s>
                                    <a:s>display: </a:s>
                                    <a:s r="348">
                                       <a:s r="347">
                                          <a:s>DI</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="348">
                                          <a:s>doseFormName</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s> }</a:s>
                              </a:s>
                           </a:s>
                           <a:s>,
      </a:s>
                           <a:s>
                              <a:s>ingredientCode: </a:s>
                              <a:s r="356">
                                 <a:s>Code { </a:s>
                                 <a:s>
                                    <a:s>code: </a:s>
                                    <a:s r="352">
                                       <a:s>ToString(</a:s>
                                       <a:s r="351">
                                          <a:s r="350">
                                             <a:s>DI</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="351">
                                             <a:s>ingredientCode</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>)</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>, </a:s>
                                 <a:s>
                                    <a:s>system: </a:s>
                                    <a:s r="353">
                                       <a:s>'http://www.nlm.nih.gov/research/umls/rxnorm'</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>, </a:s>
                                 <a:s>
                                    <a:s>display: </a:s>
                                    <a:s r="355">
                                       <a:s r="354">
                                          <a:s>DI</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="355">
                                          <a:s>ingredientName</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s> }</a:s>
                              </a:s>
                           </a:s>
                           <a:s>,
      </a:s>
                           <a:s>
                              <a:s>strength: </a:s>
                              <a:s r="362">
                                 <a:s>Quantity {
        </a:s>
                                 <a:s>
                                    <a:s>value: </a:s>
                                    <a:s r="358">
                                       <a:s r="357">
                                          <a:s>DI</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="358">
                                          <a:s>strengthValue</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>,
        </a:s>
                                 <a:s>
                                    <a:s>unit: </a:s>
                                    <a:s r="361">
                                       <a:s>ToUCUM(</a:s>
                                       <a:s r="360">
                                          <a:s r="359">
                                             <a:s>DI</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="360">
                                             <a:s>strengthUnit</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>)</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>
      }</a:s>
                              </a:s>
                           </a:s>
                           <a:s>
    }</a:s>
                        </a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="365" locator="148:3-158:5" xsi:type="Query">
            <source localId="329" locator="148:3-148:29" alias="DI">
               <expression localId="328" locator="148:3-148:26" name="DrugIngredients" libraryName="OMTKData" xsi:type="ExpressionRef"/>
            </source>
            <where localId="335" locator="149:5-149:50" xsi:type="Equal">
               <operand localId="331" locator="149:11-149:21" path="drugCode" scope="DI" xsi:type="Property"/>
               <operand localId="334" locator="149:25-149:50" xsi:type="ToInteger">
                  <operand localId="333" locator="149:35-149:49" path="code" xsi:type="Property">
                     <source localId="332" locator="149:35-149:44" name="rxNormCode" xsi:type="OperandRef"/>
                  </operand>
               </operand>
            </where>
            <return localId="364" locator="150:5-158:5">
               <expression localId="363" locator="150:12-158:5" xsi:type="Tuple">
                  <element name="rxNormCode">
                     <value localId="342" locator="151:19-151:131" classType="t:Code" xsi:type="Instance">
                        <element name="code">
                           <value localId="338" locator="151:32-151:52" xsi:type="ToString">
                              <operand localId="337" locator="151:41-151:51" path="drugCode" scope="DI" xsi:type="Property"/>
                           </value>
                        </element>
                        <element name="system">
                           <value localId="339" locator="151:63-151:107" valueType="t:String" value="http://www.nlm.nih.gov/research/umls/rxnorm" xsi:type="Literal"/>
                        </element>
                        <element name="display">
                           <value localId="341" locator="151:119-151:129" path="drugName" scope="DI" xsi:type="Property"/>
                        </element>
                     </value>
                  </element>
                  <element name="doseFormCode">
                     <value localId="349" locator="152:21-152:141" classType="t:Code" xsi:type="Instance">
                        <element name="code">
                           <value localId="345" locator="152:34-152:58" xsi:type="ToString">
                              <operand localId="344" locator="152:43-152:57" path="doseFormCode" scope="DI" xsi:type="Property"/>
                           </value>
                        </element>
                        <element name="system">
                           <value localId="346" locator="152:69-152:113" valueType="t:String" value="http://www.nlm.nih.gov/research/umls/rxnorm" xsi:type="Literal"/>
                        </element>
                        <element name="display">
                           <value localId="348" locator="152:125-152:139" path="doseFormName" scope="DI" xsi:type="Property"/>
                        </element>
                     </value>
                  </element>
                  <element name="ingredientCode">
                     <value localId="356" locator="153:23-153:147" classType="t:Code" xsi:type="Instance">
                        <element name="code">
                           <value localId="352" locator="153:36-153:62" xsi:type="ToString">
                              <operand localId="351" locator="153:45-153:61" path="ingredientCode" scope="DI" xsi:type="Property"/>
                           </value>
                        </element>
                        <element name="system">
                           <value localId="353" locator="153:73-153:117" valueType="t:String" value="http://www.nlm.nih.gov/research/umls/rxnorm" xsi:type="Literal"/>
                        </element>
                        <element name="display">
                           <value localId="355" locator="153:129-153:145" path="ingredientName" scope="DI" xsi:type="Property"/>
                        </element>
                     </value>
                  </element>
                  <element name="strength">
                     <value localId="362" locator="154:17-157:7" classType="t:Quantity" xsi:type="Instance">
                        <element name="value">
                           <value localId="358" locator="155:16-155:31" path="strengthValue" scope="DI" xsi:type="Property"/>
                        </element>
                        <element name="unit">
                           <value localId="361" locator="156:15-156:37" name="ToUCUM" xsi:type="FunctionRef">
                              <operand localId="360" locator="156:22-156:36" path="strengthUnit" scope="DI" xsi:type="Property"/>
                           </value>
                        </element>
                     </value>
                  </element>
               </expression>
            </return>
         </expression>
         <operand name="rxNormCode">
            <operandTypeSpecifier localId="327" locator="147:43-147:46" name="t:Code" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="400" locator="164:1-179:3" name="GetMedicationCode" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="400">
               <a:s>/*
Returns the first RxNorm code in the given concept that matches a drug code
specified in OMTKData.
*/define function GetMedicationCode(concept </a:s>
               <a:s r="367">
                  <a:s>Concept</a:s>
               </a:s>
               <a:s>):
  </a:s>
               <a:s r="399">
                  <a:s r="399">
                     <a:s>First(
    </a:s>
                     <a:s r="398">
                        <a:s>
                           <a:s r="395">
                              <a:s r="394">
                                 <a:s>(</a:s>
                                 <a:s r="394">
                                    <a:s>
                                       <a:s r="370">
                                          <a:s r="369">
                                             <a:s>(</a:s>
                                             <a:s r="369">
                                                <a:s r="368">
                                                   <a:s>concept</a:s>
                                                </a:s>
                                                <a:s>.</a:s>
                                                <a:s r="369">
                                                   <a:s>codes</a:s>
                                                </a:s>
                                             </a:s>
                                             <a:s>)</a:s>
                                          </a:s>
                                          <a:s> C</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>
      </a:s>
                                    <a:s r="374">
                                       <a:s>where </a:s>
                                       <a:s r="374">
                                          <a:s r="372">
                                             <a:s r="371">
                                                <a:s>C</a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="372">
                                                <a:s>system</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s> = </a:s>
                                          <a:s r="373">
                                             <a:s>'http://www.nlm.nih.gov/research/umls/rxnorm'</a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>
        </a:s>
                                    <a:s r="393">
                                       <a:s>return </a:s>
                                       <a:s r="392">
                                          <a:s>singleton from </a:s>
                                          <a:s r="391">
                                             <a:s>(
          </a:s>
                                             <a:s r="391">
                                                <a:s>
                                                   <a:s r="376">
                                                      <a:s r="375">
                                                         <a:s>
                                                            <a:s>OMTKData.DrugIngredients</a:s>
                                                         </a:s>
                                                      </a:s>
                                                      <a:s> DI</a:s>
                                                   </a:s>
                                                </a:s>
                                                <a:s>
            </a:s>
                                                <a:s r="382">
                                                   <a:s>where </a:s>
                                                   <a:s r="382">
                                                      <a:s r="378">
                                                         <a:s r="377">
                                                            <a:s>DI</a:s>
                                                         </a:s>
                                                         <a:s>.</a:s>
                                                         <a:s r="378">
                                                            <a:s>drugCode</a:s>
                                                         </a:s>
                                                      </a:s>
                                                      <a:s> = </a:s>
                                                      <a:s r="381">
                                                         <a:s>ToInteger(</a:s>
                                                         <a:s r="380">
                                                            <a:s r="379">
                                                               <a:s>C</a:s>
                                                            </a:s>
                                                            <a:s>.</a:s>
                                                            <a:s r="380">
                                                               <a:s>code</a:s>
                                                            </a:s>
                                                         </a:s>
                                                         <a:s>)</a:s>
                                                      </a:s>
                                                   </a:s>
                                                </a:s>
                                                <a:s>
            </a:s>
                                                <a:s r="390">
                                                   <a:s>return </a:s>
                                                   <a:s r="389">
                                                      <a:s>Code {
              </a:s>
                                                      <a:s>
                                                         <a:s>code: </a:s>
                                                         <a:s r="385">
                                                            <a:s>ToString(</a:s>
                                                            <a:s r="384">
                                                               <a:s r="383">
                                                                  <a:s>DI</a:s>
                                                               </a:s>
                                                               <a:s>.</a:s>
                                                               <a:s r="384">
                                                                  <a:s>drugCode</a:s>
                                                               </a:s>
                                                            </a:s>
                                                            <a:s>)</a:s>
                                                         </a:s>
                                                      </a:s>
                                                      <a:s>,
              </a:s>
                                                      <a:s>
                                                         <a:s>system: </a:s>
                                                         <a:s r="386">
                                                            <a:s>'http://www.nlm.nih.gov/research/umls/rxnorm'</a:s>
                                                         </a:s>
                                                      </a:s>
                                                      <a:s>,
              </a:s>
                                                      <a:s>
                                                         <a:s>display: </a:s>
                                                         <a:s r="388">
                                                            <a:s r="387">
                                                               <a:s>DI</a:s>
                                                            </a:s>
                                                            <a:s>.</a:s>
                                                            <a:s r="388">
                                                               <a:s>drugName</a:s>
                                                            </a:s>
                                                         </a:s>
                                                      </a:s>
                                                      <a:s>
            }</a:s>
                                                   </a:s>
                                                </a:s>
                                             </a:s>
                                             <a:s>
        )</a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>
    )</a:s>
                              </a:s>
                              <a:s> X</a:s>
                           </a:s>
                        </a:s>
                        <a:s>
      </a:s>
                        <a:s r="397">
                           <a:s>where </a:s>
                           <a:s r="397">
                              <a:s r="396">
                                 <a:s>X</a:s>
                              </a:s>
                              <a:s> is not null</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>
  )</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="399" locator="165:3-179:3" xsi:type="First">
            <source localId="398" locator="166:5-178:25" xsi:type="Query">
               <source localId="395" locator="166:5-177:7" alias="X">
                  <expression localId="394" locator="166:5-177:5" xsi:type="Query">
                     <source localId="370" locator="166:6-166:22" alias="C">
                        <expression localId="369" locator="166:6-166:20" path="codes" xsi:type="Property">
                           <source localId="368" locator="166:7-166:13" name="concept" xsi:type="OperandRef"/>
                        </expression>
                     </source>
                     <where localId="374" locator="167:7-167:68" xsi:type="Equal">
                        <operand localId="372" locator="167:13-167:20" path="system" scope="C" xsi:type="Property"/>
                        <operand localId="373" locator="167:24-167:68" valueType="t:String" value="http://www.nlm.nih.gov/research/umls/rxnorm" xsi:type="Literal"/>
                     </where>
                     <return localId="393" locator="168:9-176:9">
                        <expression localId="392" locator="168:16-176:9" xsi:type="SingletonFrom">
                           <operand localId="391" locator="168:31-176:9" xsi:type="Query">
                              <source localId="376" locator="169:11-169:37" alias="DI">
                                 <expression localId="375" locator="169:11-169:34" name="DrugIngredients" libraryName="OMTKData" xsi:type="ExpressionRef"/>
                              </source>
                              <where localId="382" locator="170:13-170:49" xsi:type="Equal">
                                 <operand localId="378" locator="170:19-170:29" path="drugCode" scope="DI" xsi:type="Property"/>
                                 <operand localId="381" locator="170:33-170:49" xsi:type="ToInteger">
                                    <operand localId="380" locator="170:43-170:48" path="code" scope="C" xsi:type="Property"/>
                                 </operand>
                              </where>
                              <return localId="390" locator="171:13-175:13">
                                 <expression localId="389" locator="171:20-175:13" classType="t:Code" xsi:type="Instance">
                                    <element name="code">
                                       <value localId="385" locator="172:21-172:41" xsi:type="ToString">
                                          <operand localId="384" locator="172:30-172:40" path="drugCode" scope="DI" xsi:type="Property"/>
                                       </value>
                                    </element>
                                    <element name="system">
                                       <value localId="386" locator="173:23-173:67" valueType="t:String" value="http://www.nlm.nih.gov/research/umls/rxnorm" xsi:type="Literal"/>
                                    </element>
                                    <element name="display">
                                       <value localId="388" locator="174:24-174:34" path="drugName" scope="DI" xsi:type="Property"/>
                                    </element>
                                 </expression>
                              </return>
                           </operand>
                        </expression>
                     </return>
                  </expression>
               </source>
               <where localId="397" locator="178:7-178:25" xsi:type="Not">
                  <operand locator="178:13-178:25" xsi:type="IsNull">
                     <operand localId="396" locator="178:13" name="X" xsi:type="AliasRef"/>
                  </operand>
               </where>
            </source>
         </expression>
         <operand name="concept">
            <operandTypeSpecifier localId="367" locator="164:43-164:49" name="t:Concept" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="433" locator="198:1-205:27" name="GetMedicationName" context="Unfiltered" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="433">
               <a:s>/*
Returns the display of the given code, if present, otherwise looks it up from the OMTK data
*/define function GetMedicationName(rxNormCode </a:s>
               <a:s r="413">
                  <a:s>Code</a:s>
               </a:s>
               <a:s>):
  </a:s>
               <a:s r="432">
                  <a:s r="432">
                     <a:s>if </a:s>
                     <a:s r="416">
                        <a:s r="415">
                           <a:s r="414">
                              <a:s>rxNormCode</a:s>
                           </a:s>
                           <a:s>.</a:s>
                           <a:s r="415">
                              <a:s>display</a:s>
                           </a:s>
                        </a:s>
                        <a:s> is null</a:s>
                     </a:s>
                     <a:s> then
    </a:s>
                     <a:s r="429">
                        <a:s>singleton from </a:s>
                        <a:s r="428">
                           <a:s>(
      </a:s>
                           <a:s r="428">
                              <a:s>
                                 <a:s r="418">
                                    <a:s r="417">
                                       <a:s>
                                          <a:s>OMTKData.DrugIngredients</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s> DI</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>
        </a:s>
                              <a:s r="424">
                                 <a:s>where </a:s>
                                 <a:s r="424">
                                    <a:s r="420">
                                       <a:s r="419">
                                          <a:s>DI</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="420">
                                          <a:s>drugCode</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s> = </a:s>
                                    <a:s r="423">
                                       <a:s>ToInteger(</a:s>
                                       <a:s r="422">
                                          <a:s r="421">
                                             <a:s>rxNormCode</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="422">
                                             <a:s>code</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>)</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>
        </a:s>
                              <a:s r="427">
                                 <a:s>return </a:s>
                                 <a:s r="426">
                                    <a:s r="425">
                                       <a:s>DI</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="426">
                                       <a:s>drugName</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                           <a:s>
    )</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    else </a:s>
                     <a:s r="431">
                        <a:s r="430">
                           <a:s>rxNormCode</a:s>
                        </a:s>
                        <a:s>.</a:s>
                        <a:s r="431">
                           <a:s>display</a:s>
                        </a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="432" locator="199:3-205:27" xsi:type="If">
            <condition localId="416" locator="199:6-199:31" xsi:type="IsNull">
               <operand localId="415" locator="199:6-199:23" path="display" xsi:type="Property">
                  <source localId="414" locator="199:6-199:15" name="rxNormCode" xsi:type="OperandRef"/>
               </operand>
            </condition>
            <then localId="429" locator="200:5-204:5" xsi:type="SingletonFrom">
               <operand localId="428" locator="200:20-204:5" xsi:type="Query">
                  <source localId="418" locator="201:7-201:33" alias="DI">
                     <expression localId="417" locator="201:7-201:30" name="DrugIngredients" libraryName="OMTKData" xsi:type="ExpressionRef"/>
                  </source>
                  <where localId="424" locator="202:9-202:54" xsi:type="Equal">
                     <operand localId="420" locator="202:15-202:25" path="drugCode" scope="DI" xsi:type="Property"/>
                     <operand localId="423" locator="202:29-202:54" xsi:type="ToInteger">
                        <operand localId="422" locator="202:39-202:53" path="code" xsi:type="Property">
                           <source localId="421" locator="202:39-202:48" name="rxNormCode" xsi:type="OperandRef"/>
                        </operand>
                     </operand>
                  </where>
                  <return localId="427" locator="203:9-203:26">
                     <expression localId="426" locator="203:16-203:26" path="drugName" scope="DI" xsi:type="Property"/>
                  </return>
               </operand>
            </then>
            <else localId="431" locator="205:10-205:27" path="display" xsi:type="Property">
               <source localId="430" locator="205:10-205:19" name="rxNormCode" xsi:type="OperandRef"/>
            </else>
         </expression>
         <operand name="rxNormCode">
            <operandTypeSpecifier localId="413" locator="198:46-198:49" name="t:Code" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="441" locator="185:1-193:19" name="GetMedicationConceptName" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="441">
               <a:s>/*
Returns the display of the given concept, if present, otherwise, looks up medication
names for any RxNormCodes within the concept using the GetMedicationName function
*/define function GetMedicationConceptName(concept </a:s>
               <a:s r="401">
                  <a:s>Concept</a:s>
               </a:s>
               <a:s>):
  </a:s>
               <a:s r="440">
                  <a:s r="440">
                     <a:s>if </a:s>
                     <a:s r="404">
                        <a:s r="403">
                           <a:s r="402">
                              <a:s>concept</a:s>
                           </a:s>
                           <a:s>.</a:s>
                           <a:s r="403">
                              <a:s>display</a:s>
                           </a:s>
                        </a:s>
                        <a:s> is null</a:s>
                     </a:s>
                     <a:s> then
    </a:s>
                     <a:s r="437">
                        <a:s>First(
      </a:s>
                        <a:s r="436">
                           <a:s>
                              <a:s r="407">
                                 <a:s r="406">
                                    <a:s>(</a:s>
                                    <a:s r="406">
                                       <a:s r="405">
                                          <a:s>concept</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="406">
                                          <a:s>codes</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>)</a:s>
                                 </a:s>
                                 <a:s> C</a:s>
                              </a:s>
                           </a:s>
                           <a:s>
        </a:s>
                           <a:s r="411">
                              <a:s>where </a:s>
                              <a:s r="411">
                                 <a:s r="409">
                                    <a:s r="408">
                                       <a:s>C</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="409">
                                       <a:s>system</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s> = </a:s>
                                 <a:s r="410">
                                    <a:s>'http://www.nlm.nih.gov/research/umls/rxnorm'</a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                           <a:s>
        </a:s>
                           <a:s r="435">
                              <a:s>return </a:s>
                              <a:s r="434">
                                 <a:s>GetMedicationName(</a:s>
                                 <a:s r="412">
                                    <a:s>C</a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>
    )</a:s>
                     </a:s>
                     <a:s>
  else
    </a:s>
                     <a:s r="439">
                        <a:s r="438">
                           <a:s>concept</a:s>
                        </a:s>
                        <a:s>.</a:s>
                        <a:s r="439">
                           <a:s>display</a:s>
                        </a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="440" locator="186:3-193:19" xsi:type="If">
            <condition localId="404" locator="186:6-186:28" xsi:type="IsNull">
               <operand localId="403" locator="186:6-186:20" path="display" xsi:type="Property">
                  <source localId="402" locator="186:6-186:12" name="concept" xsi:type="OperandRef"/>
               </operand>
            </condition>
            <then localId="437" locator="187:5-191:5" xsi:type="First">
               <source localId="436" locator="188:7-190:35" xsi:type="Query">
                  <source localId="407" locator="188:7-188:23" alias="C">
                     <expression localId="406" locator="188:7-188:21" path="codes" xsi:type="Property">
                        <source localId="405" locator="188:8-188:14" name="concept" xsi:type="OperandRef"/>
                     </expression>
                  </source>
                  <where localId="411" locator="189:9-189:70" xsi:type="Equal">
                     <operand localId="409" locator="189:15-189:22" path="system" scope="C" xsi:type="Property"/>
                     <operand localId="410" locator="189:26-189:70" valueType="t:String" value="http://www.nlm.nih.gov/research/umls/rxnorm" xsi:type="Literal"/>
                  </where>
                  <return localId="435" locator="190:9-190:35">
                     <expression localId="434" locator="190:16-190:35" name="GetMedicationName" xsi:type="FunctionRef">
                        <operand localId="412" locator="190:34" name="C" xsi:type="AliasRef"/>
                     </expression>
                  </return>
               </source>
            </then>
            <else localId="439" locator="193:5-193:19" path="display" xsi:type="Property">
               <source localId="438" locator="193:5-193:11" name="concept" xsi:type="OperandRef"/>
            </else>
         </expression>
         <operand name="concept">
            <operandTypeSpecifier localId="401" locator="185:50-185:56" name="t:Concept" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="464" locator="210:1-217:31" name="GetIngredientName" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="464">
               <a:s>/*
Returns the display of the given ingredient, if present, otherwise looks it up from the OMTK data
*/define function GetIngredientName(ingredientCode </a:s>
               <a:s r="444">
                  <a:s>Code</a:s>
               </a:s>
               <a:s>):
  </a:s>
               <a:s r="463">
                  <a:s r="463">
                     <a:s>if </a:s>
                     <a:s r="447">
                        <a:s r="446">
                           <a:s r="445">
                              <a:s>ingredientCode</a:s>
                           </a:s>
                           <a:s>.</a:s>
                           <a:s r="446">
                              <a:s>display</a:s>
                           </a:s>
                        </a:s>
                        <a:s> is null</a:s>
                     </a:s>
                     <a:s> then
    </a:s>
                     <a:s r="460">
                        <a:s>singleton from </a:s>
                        <a:s r="459">
                           <a:s>(
      </a:s>
                           <a:s r="459">
                              <a:s>
                                 <a:s r="449">
                                    <a:s r="448">
                                       <a:s>
                                          <a:s>OMTKData.DrugIngredients</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s> DI</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>
        </a:s>
                              <a:s r="455">
                                 <a:s>where </a:s>
                                 <a:s r="455">
                                    <a:s r="451">
                                       <a:s r="450">
                                          <a:s>DI</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="451">
                                          <a:s>ingredientCode</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s> = </a:s>
                                    <a:s r="454">
                                       <a:s>ToInteger(</a:s>
                                       <a:s r="453">
                                          <a:s r="452">
                                             <a:s>ingredientCode</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="453">
                                             <a:s>code</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>)</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>
        </a:s>
                              <a:s r="458">
                                 <a:s>return </a:s>
                                 <a:s r="457">
                                    <a:s r="456">
                                       <a:s>DI</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="457">
                                       <a:s>ingredientName</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                           <a:s>
    )</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    else </a:s>
                     <a:s r="462">
                        <a:s r="461">
                           <a:s>ingredientCode</a:s>
                        </a:s>
                        <a:s>.</a:s>
                        <a:s r="462">
                           <a:s>display</a:s>
                        </a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="463" locator="211:3-217:31" xsi:type="If">
            <condition localId="447" locator="211:6-211:35" xsi:type="IsNull">
               <operand localId="446" locator="211:6-211:27" path="display" xsi:type="Property">
                  <source localId="445" locator="211:6-211:19" name="ingredientCode" xsi:type="OperandRef"/>
               </operand>
            </condition>
            <then localId="460" locator="212:5-216:5" xsi:type="SingletonFrom">
               <operand localId="459" locator="212:20-216:5" xsi:type="Query">
                  <source localId="449" locator="213:7-213:33" alias="DI">
                     <expression localId="448" locator="213:7-213:30" name="DrugIngredients" libraryName="OMTKData" xsi:type="ExpressionRef"/>
                  </source>
                  <where localId="455" locator="214:9-214:64" xsi:type="Equal">
                     <operand localId="451" locator="214:15-214:31" path="ingredientCode" scope="DI" xsi:type="Property"/>
                     <operand localId="454" locator="214:35-214:64" xsi:type="ToInteger">
                        <operand localId="453" locator="214:45-214:63" path="code" xsi:type="Property">
                           <source localId="452" locator="214:45-214:58" name="ingredientCode" xsi:type="OperandRef"/>
                        </operand>
                     </operand>
                  </where>
                  <return localId="458" locator="215:9-215:32">
                     <expression localId="457" locator="215:16-215:32" path="ingredientName" scope="DI" xsi:type="Property"/>
                  </return>
               </operand>
            </then>
            <else localId="462" locator="217:10-217:31" path="display" xsi:type="Property">
               <source localId="461" locator="217:10-217:23" name="ingredientCode" xsi:type="OperandRef"/>
            </else>
         </expression>
         <operand name="ingredientCode">
            <operandTypeSpecifier localId="444" locator="210:50-210:53" name="t:Code" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="485" locator="222:1-229:29" name="GetDoseFormName" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="485">
               <a:s>/*
Returns the display of the given dose form, if present, otherwise looks it up from the OMTK data
*/define function GetDoseFormName(doseFormCode </a:s>
               <a:s r="465">
                  <a:s>Code</a:s>
               </a:s>
               <a:s>):
  </a:s>
               <a:s r="484">
                  <a:s r="484">
                     <a:s>if </a:s>
                     <a:s r="468">
                        <a:s r="467">
                           <a:s r="466">
                              <a:s>doseFormCode</a:s>
                           </a:s>
                           <a:s>.</a:s>
                           <a:s r="467">
                              <a:s>display</a:s>
                           </a:s>
                        </a:s>
                        <a:s> is null</a:s>
                     </a:s>
                     <a:s> then
    </a:s>
                     <a:s r="481">
                        <a:s>singleton from </a:s>
                        <a:s r="480">
                           <a:s>(
      </a:s>
                           <a:s r="480">
                              <a:s>
                                 <a:s r="470">
                                    <a:s r="469">
                                       <a:s>
                                          <a:s>OMTKData.DrugIngredients</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s> DI</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>
        </a:s>
                              <a:s r="476">
                                 <a:s>where </a:s>
                                 <a:s r="476">
                                    <a:s r="472">
                                       <a:s r="471">
                                          <a:s>DI</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="472">
                                          <a:s>doseFormCode</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s> = </a:s>
                                    <a:s r="475">
                                       <a:s>ToInteger(</a:s>
                                       <a:s r="474">
                                          <a:s r="473">
                                             <a:s>doseFormCode</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="474">
                                             <a:s>code</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>)</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>
        </a:s>
                              <a:s r="479">
                                 <a:s>return </a:s>
                                 <a:s r="478">
                                    <a:s r="477">
                                       <a:s>DI</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="478">
                                       <a:s>doseFormName</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                           <a:s>
    )</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    else </a:s>
                     <a:s r="483">
                        <a:s r="482">
                           <a:s>doseFormCode</a:s>
                        </a:s>
                        <a:s>.</a:s>
                        <a:s r="483">
                           <a:s>display</a:s>
                        </a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="484" locator="223:3-229:29" xsi:type="If">
            <condition localId="468" locator="223:6-223:33" xsi:type="IsNull">
               <operand localId="467" locator="223:6-223:25" path="display" xsi:type="Property">
                  <source localId="466" locator="223:6-223:17" name="doseFormCode" xsi:type="OperandRef"/>
               </operand>
            </condition>
            <then localId="481" locator="224:5-228:5" xsi:type="SingletonFrom">
               <operand localId="480" locator="224:20-228:5" xsi:type="Query">
                  <source localId="470" locator="225:7-225:33" alias="DI">
                     <expression localId="469" locator="225:7-225:30" name="DrugIngredients" libraryName="OMTKData" xsi:type="ExpressionRef"/>
                  </source>
                  <where localId="476" locator="226:9-226:60" xsi:type="Equal">
                     <operand localId="472" locator="226:15-226:29" path="doseFormCode" scope="DI" xsi:type="Property"/>
                     <operand localId="475" locator="226:33-226:60" xsi:type="ToInteger">
                        <operand localId="474" locator="226:43-226:59" path="code" xsi:type="Property">
                           <source localId="473" locator="226:43-226:54" name="doseFormCode" xsi:type="OperandRef"/>
                        </operand>
                     </operand>
                  </where>
                  <return localId="479" locator="227:9-227:30">
                     <expression localId="478" locator="227:16-227:30" path="doseFormName" scope="DI" xsi:type="Property"/>
                  </return>
               </operand>
            </then>
            <else localId="483" locator="229:10-229:29" path="display" xsi:type="Property">
               <source localId="482" locator="229:10-229:21" name="doseFormCode" xsi:type="OperandRef"/>
            </else>
         </expression>
         <operand name="doseFormCode">
            <operandTypeSpecifier localId="465" locator="222:46-222:49" name="t:Code" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="517" locator="236:1-244:12" name="StripPer" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="517">
               <a:s>/*
  Removes the last per argument from a unit
  NOTE: Rewrote to not use LastPositionOf, since that function is not implemented in the JS engine
  https://github.com/cqframework/cql-execution/issues/147
*/define function StripPer(unit </a:s>
               <a:s r="486">
                  <a:s>String</a:s>
               </a:s>
               <a:s>):
  </a:s>
               <a:s r="516">
                  <a:s r="516">
                     <a:s>
                        <a:s r="488">
                           <a:s r="487">
                              <a:s>
                                 <a:s>unit</a:s>
                              </a:s>
                           </a:s>
                           <a:s> X</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s>
                        <a:s>let </a:s>
                        <a:s r="492">
                           <a:s>split: </a:s>
                           <a:s r="491">
                              <a:s>Split(</a:s>
                              <a:s r="489">
                                 <a:s>unit</a:s>
                              </a:s>
                              <a:s>, </a:s>
                              <a:s r="490">
                                 <a:s>'/'</a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                        <a:s>,
      </a:s>
                        <a:s r="495">
                           <a:s>splitCount: </a:s>
                           <a:s r="494">
                              <a:s>Count(</a:s>
                              <a:s r="493">
                                 <a:s>split</a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="515">
                        <a:s>return
      </a:s>
                        <a:s r="514">
                           <a:s>if </a:s>
                           <a:s r="498">
                              <a:s r="496">
                                 <a:s>splitCount</a:s>
                              </a:s>
                              <a:s r="497"> > 1</a:s>
                           </a:s>
                           <a:s> then
        </a:s>
                           <a:s r="512">
                              <a:s>Substring(</a:s>
                              <a:s r="499">
                                 <a:s>unit</a:s>
                              </a:s>
                              <a:s r="500">, 0, </a:s>
                              <a:s r="511">
                                 <a:s r="509">
                                    <a:s r="502">
                                       <a:s>Length(</a:s>
                                       <a:s r="501">
                                          <a:s>unit</a:s>
                                       </a:s>
                                       <a:s>)</a:s>
                                    </a:s>
                                    <a:s> - </a:s>
                                    <a:s r="508">
                                       <a:s>Length(</a:s>
                                       <a:s r="507">
                                          <a:s r="503">
                                             <a:s>split</a:s>
                                          </a:s>
                                          <a:s>[</a:s>
                                          <a:s r="506">
                                             <a:s r="504">
                                                <a:s>splitCount</a:s>
                                             </a:s>
                                             <a:s r="505"> - 1</a:s>
                                          </a:s>
                                          <a:s>]</a:s>
                                       </a:s>
                                       <a:s>)</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s r="510"> - 1</a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                           <a:s>
      else
        </a:s>
                           <a:s r="513">
                              <a:s>unit</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="516" locator="237:3-244:12" xsi:type="Query">
            <source localId="488" locator="237:3-237:8" alias="X">
               <expression localId="487" locator="237:3-237:6" name="unit" xsi:type="OperandRef"/>
            </source>
            <let localId="492" locator="238:9-238:31" identifier="split">
               <expression localId="491" locator="238:16-238:31" xsi:type="Split">
                  <stringToSplit localId="489" locator="238:22-238:25" name="unit" xsi:type="OperandRef"/>
                  <separator localId="490" locator="238:28-238:30" valueType="t:String" value="/" xsi:type="Literal"/>
               </expression>
            </let>
            <let localId="495" locator="239:7-239:30" identifier="splitCount">
               <expression localId="494" locator="239:19-239:30" xsi:type="Count">
                  <source localId="493" locator="239:25-239:29" name="split" xsi:type="QueryLetRef"/>
               </expression>
            </let>
            <return localId="515" locator="240:5-244:12">
               <expression localId="514" locator="241:7-244:12" xsi:type="If">
                  <condition localId="498" locator="241:10-241:23" xsi:type="Greater">
                     <operand localId="496" locator="241:10-241:19" name="splitCount" xsi:type="QueryLetRef"/>
                     <operand localId="497" locator="241:23" valueType="t:Integer" value="1" xsi:type="Literal"/>
                  </condition>
                  <then localId="512" locator="242:9-242:76" xsi:type="Substring">
                     <stringToSub localId="499" locator="242:19-242:22" name="unit" xsi:type="OperandRef"/>
                     <startIndex localId="500" locator="242:25" valueType="t:Integer" value="0" xsi:type="Literal"/>
                     <length localId="511" locator="242:28-242:75" xsi:type="Subtract">
                        <operand localId="509" locator="242:28-242:71" xsi:type="Subtract">
                           <operand localId="502" locator="242:28-242:39" xsi:type="Length">
                              <operand localId="501" locator="242:35-242:38" name="unit" xsi:type="OperandRef"/>
                           </operand>
                           <operand localId="508" locator="242:43-242:71" xsi:type="Length">
                              <operand localId="507" locator="242:50-242:70" xsi:type="Indexer">
                                 <operand localId="503" locator="242:50-242:54" name="split" xsi:type="QueryLetRef"/>
                                 <operand localId="506" locator="242:56-242:69" xsi:type="Subtract">
                                    <operand localId="504" locator="242:56-242:65" name="splitCount" xsi:type="QueryLetRef"/>
                                    <operand localId="505" locator="242:69" valueType="t:Integer" value="1" xsi:type="Literal"/>
                                 </operand>
                              </operand>
                           </operand>
                        </operand>
                        <operand localId="510" locator="242:75" valueType="t:Integer" value="1" xsi:type="Literal"/>
                     </length>
                  </then>
                  <else localId="513" locator="244:9-244:12" name="unit" xsi:type="OperandRef"/>
               </expression>
            </return>
         </expression>
         <operand name="unit">
            <operandTypeSpecifier localId="486" locator="236:31-236:36" name="t:String" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="754" locator="259:1-304:5" name="GetDailyDose" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="754">
               <a:s>/*
define function StripPer(unit String):
  if LastPositionOf('/', unit) >= 0
    then Substring(unit, 0, LastPositionOf('/', unit))
    else unit
*/

/*
  Calculates daily dose for a specific ingredient based on the ingredient strength,
  dose form, dose quantity, and daily frequency.
  In addition, returns a textual description of the daily dose.
  Tuple { result: Quantity, description: String }
*/define function GetDailyDose(ingredientCode </a:s>
               <a:s r="518">
                  <a:s>Code</a:s>
               </a:s>
               <a:s>, strength </a:s>
               <a:s r="519">
                  <a:s>Quantity</a:s>
               </a:s>
               <a:s>, doseFormCode </a:s>
               <a:s r="520">
                  <a:s>Code</a:s>
               </a:s>
               <a:s>, doseQuantity </a:s>
               <a:s r="521">
                  <a:s>Quantity</a:s>
               </a:s>
               <a:s>, dosesPerDay </a:s>
               <a:s r="522">
                  <a:s>Decimal</a:s>
               </a:s>
               <a:s>):
  </a:s>
               <a:s r="753">
                  <a:s r="753">
                     <a:s>case
    </a:s>
                     <a:s r="544">
                        <a:s>when </a:s>
                        <a:s r="538">
                           <a:s r="534">
                              <a:s r="530">
                                 <a:s r="527">
                                    <a:s r="524">
                                       <a:s r="523">
                                          <a:s>dosesPerDay</a:s>
                                       </a:s>
                                       <a:s> is null</a:s>
                                    </a:s>
                                    <a:s> or </a:s>
                                    <a:s r="526">
                                       <a:s r="525">
                                          <a:s>doseQuantity</a:s>
                                       </a:s>
                                       <a:s> is null</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s> or </a:s>
                                 <a:s r="529">
                                    <a:s r="528">
                                       <a:s>strength</a:s>
                                    </a:s>
                                    <a:s> is null</a:s>
                                 </a:s>
                              </a:s>
                              <a:s> or </a:s>
                              <a:s r="533">
                                 <a:s r="532">
                                    <a:s r="531">
                                       <a:s>strength</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="532">
                                       <a:s>value</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s> is null</a:s>
                              </a:s>
                           </a:s>
                           <a:s> or </a:s>
                           <a:s r="537">
                              <a:s r="536">
                                 <a:s r="535">
                                    <a:s>strength</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="536">
                                    <a:s>unit</a:s>
                                 </a:s>
                              </a:s>
                              <a:s> is null</a:s>
                           </a:s>
                        </a:s>
                        <a:s> then
      </a:s>
                        <a:s r="543">
                           <a:s>{
        </a:s>
                           <a:s>
                              <a:s>result: </a:s>
                              <a:s r="541">
                                 <a:s r="539">null as </a:s>
                                 <a:s r="540">
                                    <a:s>Quantity</a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                           <a:s>,
        </a:s>
                           <a:s>
                              <a:s>description: </a:s>
                              <a:s r="542">
                                 <a:s>'Missing doses per day, dose quantity, and/or strength'</a:s>
                              </a:s>
                           </a:s>
                           <a:s>
      }</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
	  /* if patch --> daily dose = dose value (e.g, number patches with doseQuantity unit = &quot;patch&quot;) * per-hour strength */
    </a:s>
                     <a:s r="609">
                        <a:s>when </a:s>
                        <a:s r="549">
                           <a:s r="547">
                              <a:s>ToInteger(</a:s>
                              <a:s r="546">
                                 <a:s r="545">
                                    <a:s>doseFormCode</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="546">
                                    <a:s>code</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                           <a:s r="548"> = 316987</a:s>
                        </a:s>
                        <a:s> then
      /* buprenorphine or fentanyl patch */
      </a:s>
                        <a:s r="608">
                           <a:s>if </a:s>
                           <a:s r="556">
                              <a:s r="552">
                                 <a:s>ToInteger(</a:s>
                                 <a:s r="551">
                                    <a:s r="550">
                                       <a:s>ingredientCode</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="551">
                                       <a:s>code</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                              <a:s> in </a:s>
                              <a:s r="555">
                                 <a:s r="553">{ 1819, 4337 }</a:s>
                              </a:s>
                           </a:s>
                           <a:s> then
        </a:s>
                           <a:s r="594">
                              <a:s>
                                 <a:s r="567">
                                    <a:s r="566">
                                       <a:s>(</a:s>
                                       <a:s r="566">
                                          <a:s>Quantity { </a:s>
                                          <a:s>
                                             <a:s>value: </a:s>
                                             <a:s r="563">
                                                <a:s r="560">
                                                   <a:s r="557">
                                                      <a:s>dosesPerDay</a:s>
                                                   </a:s>
                                                   <a:s> * </a:s>
                                                   <a:s r="559">
                                                      <a:s r="558">
                                                         <a:s>doseQuantity</a:s>
                                                      </a:s>
                                                      <a:s>.</a:s>
                                                      <a:s r="559">
                                                         <a:s>value</a:s>
                                                      </a:s>
                                                   </a:s>
                                                </a:s>
                                                <a:s> * </a:s>
                                                <a:s r="562">
                                                   <a:s r="561">
                                                      <a:s>strength</a:s>
                                                   </a:s>
                                                   <a:s>.</a:s>
                                                   <a:s r="562">
                                                      <a:s>value</a:s>
                                                   </a:s>
                                                </a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s>, </a:s>
                                          <a:s>
                                             <a:s>unit: </a:s>
                                             <a:s r="565">
                                                <a:s r="564">
                                                   <a:s>strength</a:s>
                                                </a:s>
                                                <a:s>.</a:s>
                                                <a:s r="565">
                                                   <a:s>unit</a:s>
                                                </a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s> }</a:s>
                                       </a:s>
                                       <a:s>)</a:s>
                                    </a:s>
                                    <a:s> dailyDose</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>
          </a:s>
                              <a:s r="593">
                                 <a:s>return </a:s>
                                 <a:s r="592">
                                    <a:s>{
            </a:s>
                                    <a:s>
                                       <a:s>result: </a:s>
                                       <a:s r="568">
                                          <a:s>dailyDose</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>,
            </a:s>
                                    <a:s>
                                       <a:s>description: </a:s>
                                       <a:s r="591">
                                          <a:s r="588">
                                             <a:s r="586">
                                                <a:s r="583">
                                                   <a:s r="581">
                                                      <a:s r="578">
                                                         <a:s r="576">
                                                            <a:s r="572">
                                                               <a:s r="570">
                                                                  <a:s>GetIngredientName(</a:s>
                                                                  <a:s r="569">
                                                                     <a:s>ingredientCode</a:s>
                                                                  </a:s>
                                                                  <a:s>)</a:s>
                                                               </a:s>
                                                               <a:s> &amp; </a:s>
                                                               <a:s r="571">
                                                                  <a:s>' patch: '</a:s>
                                                               </a:s>
                                                            </a:s>
                                                            <a:s> &amp; </a:s>
                                                            <a:s r="575">
                                                               <a:s>ToString(</a:s>
                                                               <a:s r="574">
                                                                  <a:s r="573">
                                                                     <a:s>doseQuantity</a:s>
                                                                  </a:s>
                                                                  <a:s>.</a:s>
                                                                  <a:s r="574">
                                                                     <a:s>value</a:s>
                                                                  </a:s>
                                                               </a:s>
                                                               <a:s>)</a:s>
                                                            </a:s>
                                                         </a:s>
                                                         <a:s> &amp; </a:s>
                                                         <a:s r="577">
                                                            <a:s>' * '</a:s>
                                                         </a:s>
                                                      </a:s>
                                                      <a:s> &amp; </a:s>
                                                      <a:s r="580">
                                                         <a:s>ToString(</a:s>
                                                         <a:s r="579">
                                                            <a:s>dosesPerDay</a:s>
                                                         </a:s>
                                                         <a:s>)</a:s>
                                                      </a:s>
                                                   </a:s>
                                                   <a:s> &amp; </a:s>
                                                   <a:s r="582">
                                                      <a:s>'/d * '</a:s>
                                                   </a:s>
                                                </a:s>
                                                <a:s> &amp; </a:s>
                                                <a:s r="585">
                                                   <a:s>ToString(</a:s>
                                                   <a:s r="584">
                                                      <a:s>strength</a:s>
                                                   </a:s>
                                                   <a:s>)</a:s>
                                                </a:s>
                                             </a:s>
                                             <a:s> &amp; </a:s>
                                             <a:s r="587">
                                                <a:s>' = '</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s> + </a:s>
                                          <a:s r="590">
                                             <a:s>ToString(</a:s>
                                             <a:s r="589">
                                                <a:s>dailyDose</a:s>
                                             </a:s>
                                             <a:s>)</a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>
          }</a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                           <a:s>
      else
        </a:s>
                           <a:s r="607">
                              <a:s>{
          </a:s>
                              <a:s>
                                 <a:s>result: </a:s>
                                 <a:s r="597">
                                    <a:s r="595">null as </a:s>
                                    <a:s r="596">
                                       <a:s>Quantity</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>,
          </a:s>
                              <a:s>
                                 <a:s>description: </a:s>
                                 <a:s r="606">
                                    <a:s r="603">
                                       <a:s r="601">
                                          <a:s r="598">
                                             <a:s>'Unknown patch ingredient: '</a:s>
                                          </a:s>
                                          <a:s> &amp; </a:s>
                                          <a:s r="600">
                                             <a:s r="599">
                                                <a:s>ingredientCode</a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="600">
                                                <a:s>code</a:s>
                                             </a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s> &amp; </a:s>
                                       <a:s r="602">
                                          <a:s>':'</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s> &amp; </a:s>
                                    <a:s r="605">
                                       <a:s r="604">
                                          <a:s>ingredientCode</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="605">
                                          <a:s>display</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>
        }</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>

    /* if dose unit in actual mass units (mg or ug -- when it's a single med) --> daily dose = numTimesPerDay * dose */
    </a:s>
                     <a:s r="650">
                        <a:s>when </a:s>
                        <a:s r="615">
                           <a:s r="611">
                              <a:s r="610">
                                 <a:s>doseQuantity</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="611">
                                 <a:s>unit</a:s>
                              </a:s>
                           </a:s>
                           <a:s> in </a:s>
                           <a:s r="614">
                              <a:s>{ </a:s>
                              <a:s r="612">
                                 <a:s>'mg'</a:s>
                              </a:s>
                              <a:s>, </a:s>
                              <a:s r="613">
                                 <a:s>'ug'</a:s>
                              </a:s>
                              <a:s> }</a:s>
                           </a:s>
                        </a:s>
                        <a:s> then
      </a:s>
                        <a:s r="649">
                           <a:s>
                              <a:s r="623">
                                 <a:s r="622">
                                    <a:s>(</a:s>
                                    <a:s r="622">
                                       <a:s>Quantity { </a:s>
                                       <a:s>
                                          <a:s>value: </a:s>
                                          <a:s r="619">
                                             <a:s r="616">
                                                <a:s>dosesPerDay</a:s>
                                             </a:s>
                                             <a:s> * </a:s>
                                             <a:s r="618">
                                                <a:s r="617">
                                                   <a:s>doseQuantity</a:s>
                                                </a:s>
                                                <a:s>.</a:s>
                                                <a:s r="618">
                                                   <a:s>value</a:s>
                                                </a:s>
                                             </a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>, </a:s>
                                       <a:s>
                                          <a:s>unit: </a:s>
                                          <a:s r="621">
                                             <a:s r="620">
                                                <a:s>doseQuantity</a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="621">
                                                <a:s>unit</a:s>
                                             </a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s> }</a:s>
                                    </a:s>
                                    <a:s>)</a:s>
                                 </a:s>
                                 <a:s> dailyDose</a:s>
                              </a:s>
                           </a:s>
                           <a:s>
        </a:s>
                           <a:s r="648">
                              <a:s>return </a:s>
                              <a:s r="647">
                                 <a:s>{
          </a:s>
                                 <a:s>
                                    <a:s>result: </a:s>
                                    <a:s r="624">
                                       <a:s>dailyDose</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>,
          </a:s>
                                 <a:s>
                                    <a:s>description: </a:s>
                                    <a:s r="646">
                                       <a:s r="643">
                                          <a:s r="641">
                                             <a:s r="638">
                                                <a:s r="636">
                                                   <a:s r="633">
                                                      <a:s r="631">
                                                         <a:s r="628">
                                                            <a:s r="626">
                                                               <a:s>GetIngredientName(</a:s>
                                                               <a:s r="625">
                                                                  <a:s>ingredientCode</a:s>
                                                               </a:s>
                                                               <a:s>)</a:s>
                                                            </a:s>
                                                            <a:s> + </a:s>
                                                            <a:s r="627">
                                                               <a:s>' '</a:s>
                                                            </a:s>
                                                         </a:s>
                                                         <a:s> + </a:s>
                                                         <a:s r="630">
                                                            <a:s>GetDoseFormName(</a:s>
                                                            <a:s r="629">
                                                               <a:s>doseFormCode</a:s>
                                                            </a:s>
                                                            <a:s>)</a:s>
                                                         </a:s>
                                                      </a:s>
                                                      <a:s> + </a:s>
                                                      <a:s r="632">
                                                         <a:s>': '</a:s>
                                                      </a:s>
                                                   </a:s>
                                                   <a:s> + </a:s>
                                                   <a:s r="635">
                                                      <a:s>ToString(</a:s>
                                                      <a:s r="634">
                                                         <a:s>dosesPerDay</a:s>
                                                      </a:s>
                                                      <a:s>)</a:s>
                                                   </a:s>
                                                </a:s>
                                                <a:s> + </a:s>
                                                <a:s r="637">
                                                   <a:s>'/d * '</a:s>
                                                </a:s>
                                             </a:s>
                                             <a:s> + </a:s>
                                             <a:s r="640">
                                                <a:s>ToString(</a:s>
                                                <a:s r="639">
                                                   <a:s>doseQuantity</a:s>
                                                </a:s>
                                                <a:s>)</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s> + </a:s>
                                          <a:s r="642">
                                             <a:s>' = '</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s> + </a:s>
                                       <a:s r="645">
                                          <a:s>ToString(</a:s>
                                          <a:s r="644">
                                             <a:s>dailyDose</a:s>
                                          </a:s>
                                          <a:s>)</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>
        }</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>

    /* if doseQuantity is in actual volume units (mL) --> daily dose = numTimesPerDay * dose * strength */
    </a:s>
                     <a:s r="709">
                        <a:s>when </a:s>
                        <a:s r="665">
                           <a:s r="654">
                              <a:s r="652">
                                 <a:s r="651">
                                    <a:s>doseQuantity</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="652">
                                    <a:s>unit</a:s>
                                 </a:s>
                              </a:s>
                              <a:s> = </a:s>
                              <a:s r="653">
                                 <a:s>'mL'</a:s>
                              </a:s>
                           </a:s>
                           <a:s> and </a:s>
                           <a:s r="664">
                              <a:s>(</a:s>
                              <a:s r="664">
                                 <a:s r="658">
                                    <a:s>PositionOf(</a:s>
                                    <a:s r="655">
                                       <a:s>'/mL'</a:s>
                                    </a:s>
                                    <a:s>, </a:s>
                                    <a:s r="657">
                                       <a:s r="656">
                                          <a:s>strength</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="657">
                                          <a:s>unit</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>)</a:s>
                                 </a:s>
                                 <a:s> = </a:s>
                                 <a:s r="663">
                                    <a:s r="661">
                                       <a:s>Length(</a:s>
                                       <a:s r="660">
                                          <a:s r="659">
                                             <a:s>strength</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="660">
                                             <a:s>unit</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>)</a:s>
                                    </a:s>
                                    <a:s r="662"> - 3</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                        <a:s> then
      </a:s>
                        <a:s r="708">
                           <a:s>
                              <a:s r="677">
                                 <a:s r="676">
                                    <a:s>(</a:s>
                                    <a:s r="676">
                                       <a:s>Quantity { </a:s>
                                       <a:s>
                                          <a:s>value: </a:s>
                                          <a:s r="672">
                                             <a:s r="669">
                                                <a:s r="666">
                                                   <a:s>dosesPerDay</a:s>
                                                </a:s>
                                                <a:s> * </a:s>
                                                <a:s r="668">
                                                   <a:s r="667">
                                                      <a:s>doseQuantity</a:s>
                                                   </a:s>
                                                   <a:s>.</a:s>
                                                   <a:s r="668">
                                                      <a:s>value</a:s>
                                                   </a:s>
                                                </a:s>
                                             </a:s>
                                             <a:s> * </a:s>
                                             <a:s r="671">
                                                <a:s r="670">
                                                   <a:s>strength</a:s>
                                                </a:s>
                                                <a:s>.</a:s>
                                                <a:s r="671">
                                                   <a:s>value</a:s>
                                                </a:s>
                                             </a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>, </a:s>
                                       <a:s>
                                          <a:s>unit: </a:s>
                                          <a:s r="675">
                                             <a:s>StripPer(</a:s>
                                             <a:s r="674">
                                                <a:s r="673">
                                                   <a:s>strength</a:s>
                                                </a:s>
                                                <a:s>.</a:s>
                                                <a:s r="674">
                                                   <a:s>unit</a:s>
                                                </a:s>
                                             </a:s>
                                             <a:s>)</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s> }</a:s>
                                    </a:s>
                                    <a:s>)</a:s>
                                 </a:s>
                                 <a:s> dailyDose</a:s>
                              </a:s>
                           </a:s>
                           <a:s>
        </a:s>
                           <a:s r="707">
                              <a:s>return </a:s>
                              <a:s r="706">
                                 <a:s>{
          </a:s>
                                 <a:s>
                                    <a:s>result: </a:s>
                                    <a:s r="678">
                                       <a:s>dailyDose</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>,
          </a:s>
                                 <a:s>
                                    <a:s>description: </a:s>
                                    <a:s r="705">
                                       <a:s r="702">
                                          <a:s r="700">
                                             <a:s r="697">
                                                <a:s r="695">
                                                   <a:s r="692">
                                                      <a:s r="690">
                                                         <a:s r="687">
                                                            <a:s r="685">
                                                               <a:s r="682">
                                                                  <a:s r="680">
                                                                     <a:s>GetIngredientName(</a:s>
                                                                     <a:s r="679">
                                                                        <a:s>ingredientCode</a:s>
                                                                     </a:s>
                                                                     <a:s>)</a:s>
                                                                  </a:s>
                                                                  <a:s> + </a:s>
                                                                  <a:s r="681">
                                                                     <a:s>' '</a:s>
                                                                  </a:s>
                                                               </a:s>
                                                               <a:s> + </a:s>
                                                               <a:s r="684">
                                                                  <a:s>GetDoseFormName(</a:s>
                                                                  <a:s r="683">
                                                                     <a:s>doseFormCode</a:s>
                                                                  </a:s>
                                                                  <a:s>)</a:s>
                                                               </a:s>
                                                            </a:s>
                                                            <a:s> + </a:s>
                                                            <a:s r="686">
                                                               <a:s>': '</a:s>
                                                            </a:s>
                                                         </a:s>
                                                         <a:s> + </a:s>
                                                         <a:s r="689">
                                                            <a:s>ToString(</a:s>
                                                            <a:s r="688">
                                                               <a:s>dosesPerDay</a:s>
                                                            </a:s>
                                                            <a:s>)</a:s>
                                                         </a:s>
                                                      </a:s>
                                                      <a:s> + </a:s>
                                                      <a:s r="691">
                                                         <a:s>'/d * '</a:s>
                                                      </a:s>
                                                   </a:s>
                                                   <a:s> + </a:s>
                                                   <a:s r="694">
                                                      <a:s>ToString(</a:s>
                                                      <a:s r="693">
                                                         <a:s>doseQuantity</a:s>
                                                      </a:s>
                                                      <a:s>)</a:s>
                                                   </a:s>
                                                </a:s>
                                                <a:s> + </a:s>
                                                <a:s r="696">
                                                   <a:s>' * '</a:s>
                                                </a:s>
                                             </a:s>
                                             <a:s> &amp; </a:s>
                                             <a:s r="699">
                                                <a:s>ToString(</a:s>
                                                <a:s r="698">
                                                   <a:s>strength</a:s>
                                                </a:s>
                                                <a:s>)</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s> &amp; </a:s>
                                          <a:s r="701">
                                             <a:s>' = '</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s> + </a:s>
                                       <a:s r="704">
                                          <a:s>ToString(</a:s>
                                          <a:s r="703">
                                             <a:s>dailyDose</a:s>
                                          </a:s>
                                          <a:s>)</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>
        }</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>

		/* if doseQuantity is not in actual units (e.g., 1 tab, 1 spray -- when it's a combo med with a unit of tablet, or it's mg/actuat) -->  daily dose = numTimesPerDay * dose value * strength value */
    else
      </a:s>
                     <a:s r="752">
                        <a:s>
                           <a:s r="721">
                              <a:s r="720">
                                 <a:s>(</a:s>
                                 <a:s r="720">
                                    <a:s>Quantity { </a:s>
                                    <a:s>
                                       <a:s>value: </a:s>
                                       <a:s r="716">
                                          <a:s r="713">
                                             <a:s r="710">
                                                <a:s>dosesPerDay</a:s>
                                             </a:s>
                                             <a:s> * </a:s>
                                             <a:s r="712">
                                                <a:s r="711">
                                                   <a:s>doseQuantity</a:s>
                                                </a:s>
                                                <a:s>.</a:s>
                                                <a:s r="712">
                                                   <a:s>value</a:s>
                                                </a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s> * </a:s>
                                          <a:s r="715">
                                             <a:s r="714">
                                                <a:s>strength</a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="715">
                                                <a:s>value</a:s>
                                             </a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>, </a:s>
                                    <a:s>
                                       <a:s>unit: </a:s>
                                       <a:s r="719">
                                          <a:s>StripPer(</a:s>
                                          <a:s r="718">
                                             <a:s r="717">
                                                <a:s>strength</a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="718">
                                                <a:s>unit</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s>)</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s> }</a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                              <a:s> dailyDose</a:s>
                           </a:s>
                        </a:s>
                        <a:s>
        </a:s>
                        <a:s r="751">
                           <a:s>return </a:s>
                           <a:s r="750">
                              <a:s>{
          </a:s>
                              <a:s>
                                 <a:s>result: </a:s>
                                 <a:s r="722">
                                    <a:s>dailyDose</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>,
          </a:s>
                              <a:s>
                                 <a:s>description: </a:s>
                                 <a:s r="749">
                                    <a:s r="746">
                                       <a:s r="744">
                                          <a:s r="741">
                                             <a:s r="739">
                                                <a:s r="736">
                                                   <a:s r="734">
                                                      <a:s r="731">
                                                         <a:s r="729">
                                                            <a:s r="726">
                                                               <a:s r="724">
                                                                  <a:s>GetIngredientName(</a:s>
                                                                  <a:s r="723">
                                                                     <a:s>ingredientCode</a:s>
                                                                  </a:s>
                                                                  <a:s>)</a:s>
                                                               </a:s>
                                                               <a:s> + </a:s>
                                                               <a:s r="725">
                                                                  <a:s>' '</a:s>
                                                               </a:s>
                                                            </a:s>
                                                            <a:s> + </a:s>
                                                            <a:s r="728">
                                                               <a:s>GetDoseFormName(</a:s>
                                                               <a:s r="727">
                                                                  <a:s>doseFormCode</a:s>
                                                               </a:s>
                                                               <a:s>)</a:s>
                                                            </a:s>
                                                         </a:s>
                                                         <a:s> + </a:s>
                                                         <a:s r="730">
                                                            <a:s>': '</a:s>
                                                         </a:s>
                                                      </a:s>
                                                      <a:s> + </a:s>
                                                      <a:s r="733">
                                                         <a:s>ToString(</a:s>
                                                         <a:s r="732">
                                                            <a:s>dosesPerDay</a:s>
                                                         </a:s>
                                                         <a:s>)</a:s>
                                                      </a:s>
                                                   </a:s>
                                                   <a:s> + </a:s>
                                                   <a:s r="735">
                                                      <a:s>'/d * '</a:s>
                                                   </a:s>
                                                </a:s>
                                                <a:s> + </a:s>
                                                <a:s r="738">
                                                   <a:s>ToString(</a:s>
                                                   <a:s r="737">
                                                      <a:s>doseQuantity</a:s>
                                                   </a:s>
                                                   <a:s>)</a:s>
                                                </a:s>
                                             </a:s>
                                             <a:s> + </a:s>
                                             <a:s r="740">
                                                <a:s>' * '</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s> + </a:s>
                                          <a:s r="743">
                                             <a:s>ToString(</a:s>
                                             <a:s r="742">
                                                <a:s>strength</a:s>
                                             </a:s>
                                             <a:s>)</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s> + </a:s>
                                       <a:s r="745">
                                          <a:s>' = '</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s> + </a:s>
                                    <a:s r="748">
                                       <a:s>ToString(</a:s>
                                       <a:s r="747">
                                          <a:s>dailyDose</a:s>
                                       </a:s>
                                       <a:s>)</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>
        }</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>
  end</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="753" locator="260:3-304:5" xsi:type="Case">
            <caseItem localId="544" locator="261:5-265:7">
               <when localId="538" locator="261:10-261:123" xsi:type="Or">
                  <operand localId="534" locator="261:10-261:98" xsi:type="Or">
                     <operand localId="530" locator="261:10-261:72" xsi:type="Or">
                        <operand localId="527" locator="261:10-261:52" xsi:type="Or">
                           <operand localId="524" locator="261:10-261:28" xsi:type="IsNull">
                              <operand localId="523" locator="261:10-261:20" name="dosesPerDay" xsi:type="OperandRef"/>
                           </operand>
                           <operand localId="526" locator="261:33-261:52" xsi:type="IsNull">
                              <operand localId="525" locator="261:33-261:44" name="doseQuantity" xsi:type="OperandRef"/>
                           </operand>
                        </operand>
                        <operand localId="529" locator="261:57-261:72" xsi:type="IsNull">
                           <operand localId="528" locator="261:57-261:64" name="strength" xsi:type="OperandRef"/>
                        </operand>
                     </operand>
                     <operand localId="533" locator="261:77-261:98" xsi:type="IsNull">
                        <operand localId="532" locator="261:77-261:90" path="value" xsi:type="Property">
                           <source localId="531" locator="261:77-261:84" name="strength" xsi:type="OperandRef"/>
                        </operand>
                     </operand>
                  </operand>
                  <operand localId="537" locator="261:103-261:123" xsi:type="IsNull">
                     <operand localId="536" locator="261:103-261:115" path="unit" xsi:type="Property">
                        <source localId="535" locator="261:103-261:110" name="strength" xsi:type="OperandRef"/>
                     </operand>
                  </operand>
               </when>
               <then localId="543" locator="262:7-265:7" xsi:type="Tuple">
                  <element name="result">
                     <value localId="541" locator="263:17-263:32" strict="false" xsi:type="As">
                        <operand localId="539" locator="263:17-263:20" xsi:type="Null"/>
                        <asTypeSpecifier localId="540" locator="263:25-263:32" name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
                     </value>
                  </element>
                  <element name="description">
                     <value localId="542" locator="264:22-264:76" valueType="t:String" value="Missing doses per day, dose quantity, and/or strength" xsi:type="Literal"/>
                  </element>
               </then>
            </caseItem>
            <caseItem localId="609" locator="267:5-279:9">
               <when localId="549" locator="267:10-267:46" xsi:type="Equal">
                  <operand localId="547" locator="267:10-267:37" xsi:type="ToInteger">
                     <operand localId="546" locator="267:20-267:36" path="code" xsi:type="Property">
                        <source localId="545" locator="267:20-267:31" name="doseFormCode" xsi:type="OperandRef"/>
                     </operand>
                  </operand>
                  <operand localId="548" locator="267:41-267:46" valueType="t:Integer" value="316987" xsi:type="Literal"/>
               </when>
               <then localId="608" locator="269:7-279:9" xsi:type="If">
                  <condition localId="556" locator="269:10-269:57" xsi:type="In">
                     <operand localId="552" locator="269:10-269:39" xsi:type="ToInteger">
                        <operand localId="551" locator="269:20-269:38" path="code" xsi:type="Property">
                           <source localId="550" locator="269:20-269:33" name="ingredientCode" xsi:type="OperandRef"/>
                        </operand>
                     </operand>
                     <operand localId="555" locator="269:44-269:57" xsi:type="List">
                        <element localId="553" locator="269:46-269:49" valueType="t:Integer" value="1819" xsi:type="Literal"/>
                        <element localId="554" locator="269:52-269:55" valueType="t:Integer" value="4337" xsi:type="Literal"/>
                     </operand>
                  </condition>
                  <then localId="594" locator="270:9-274:11" xsi:type="Query">
                     <source localId="567" locator="270:9-270:110" alias="dailyDose">
                        <expression localId="566" locator="270:9-270:100" classType="t:Quantity" xsi:type="Instance">
                           <element name="value">
                              <value localId="563" locator="270:28-270:76" xsi:type="Multiply">
                                 <operand localId="560" locator="270:28-270:59" xsi:type="Multiply">
                                    <operand localId="557" locator="270:28-270:38" name="dosesPerDay" xsi:type="OperandRef"/>
                                    <operand localId="559" locator="270:42-270:59" path="value" xsi:type="Property">
                                       <source localId="558" locator="270:42-270:53" name="doseQuantity" xsi:type="OperandRef"/>
                                    </operand>
                                 </operand>
                                 <operand localId="562" locator="270:63-270:76" path="value" xsi:type="Property">
                                    <source localId="561" locator="270:63-270:70" name="strength" xsi:type="OperandRef"/>
                                 </operand>
                              </value>
                           </element>
                           <element name="unit">
                              <value localId="565" locator="270:85-270:97" path="unit" xsi:type="Property">
                                 <source localId="564" locator="270:85-270:92" name="strength" xsi:type="OperandRef"/>
                              </value>
                           </element>
                        </expression>
                     </source>
                     <return localId="593" locator="271:11-274:11">
                        <expression localId="592" locator="271:18-274:11" xsi:type="Tuple">
                           <element name="result">
                              <value localId="568" locator="272:21-272:29" name="dailyDose" xsi:type="AliasRef"/>
                           </element>
                           <element name="description">
                              <value localId="591" locator="273:26-273:195" xsi:type="Concatenate">
                                 <operand localId="588" locator="273:26-273:173" xsi:type="Concatenate">
                                    <operand xsi:type="Coalesce">
                                       <operand localId="586" locator="273:26-273:165" xsi:type="Concatenate">
                                          <operand xsi:type="Coalesce">
                                             <operand localId="583" locator="273:26-273:144" xsi:type="Concatenate">
                                                <operand xsi:type="Coalesce">
                                                   <operand localId="581" locator="273:26-273:134" xsi:type="Concatenate">
                                                      <operand xsi:type="Coalesce">
                                                         <operand localId="578" locator="273:26-273:110" xsi:type="Concatenate">
                                                            <operand xsi:type="Coalesce">
                                                               <operand localId="576" locator="273:26-273:102" xsi:type="Concatenate">
                                                                  <operand xsi:type="Coalesce">
                                                                     <operand localId="572" locator="273:26-273:71" xsi:type="Concatenate">
                                                                        <operand xsi:type="Coalesce">
                                                                           <operand localId="570" locator="273:26-273:58" name="GetIngredientName" xsi:type="FunctionRef">
                                                                              <operand localId="569" locator="273:44-273:57" name="ingredientCode" xsi:type="OperandRef"/>
                                                                           </operand>
                                                                           <operand valueType="t:String" value="" xsi:type="Literal"/>
                                                                        </operand>
                                                                        <operand xsi:type="Coalesce">
                                                                           <operand localId="571" locator="273:62-273:71" valueType="t:String" value=" patch: " xsi:type="Literal"/>
                                                                           <operand valueType="t:String" value="" xsi:type="Literal"/>
                                                                        </operand>
                                                                     </operand>
                                                                     <operand valueType="t:String" value="" xsi:type="Literal"/>
                                                                  </operand>
                                                                  <operand xsi:type="Coalesce">
                                                                     <operand localId="575" locator="273:75-273:102" xsi:type="ToString">
                                                                        <operand localId="574" locator="273:84-273:101" path="value" xsi:type="Property">
                                                                           <source localId="573" locator="273:84-273:95" name="doseQuantity" xsi:type="OperandRef"/>
                                                                        </operand>
                                                                     </operand>
                                                                     <operand valueType="t:String" value="" xsi:type="Literal"/>
                                                                  </operand>
                                                               </operand>
                                                               <operand valueType="t:String" value="" xsi:type="Literal"/>
                                                            </operand>
                                                            <operand xsi:type="Coalesce">
                                                               <operand localId="577" locator="273:106-273:110" valueType="t:String" value=" * " xsi:type="Literal"/>
                                                               <operand valueType="t:String" value="" xsi:type="Literal"/>
                                                            </operand>
                                                         </operand>
                                                         <operand valueType="t:String" value="" xsi:type="Literal"/>
                                                      </operand>
                                                      <operand xsi:type="Coalesce">
                                                         <operand localId="580" locator="273:114-273:134" xsi:type="ToString">
                                                            <operand localId="579" locator="273:123-273:133" name="dosesPerDay" xsi:type="OperandRef"/>
                                                         </operand>
                                                         <operand valueType="t:String" value="" xsi:type="Literal"/>
                                                      </operand>
                                                   </operand>
                                                   <operand valueType="t:String" value="" xsi:type="Literal"/>
                                                </operand>
                                                <operand xsi:type="Coalesce">
                                                   <operand localId="582" locator="273:138-273:144" valueType="t:String" value="/d * " xsi:type="Literal"/>
                                                   <operand valueType="t:String" value="" xsi:type="Literal"/>
                                                </operand>
                                             </operand>
                                             <operand valueType="t:String" value="" xsi:type="Literal"/>
                                          </operand>
                                          <operand xsi:type="Coalesce">
                                             <operand localId="585" locator="273:148-273:165" xsi:type="ToString">
                                                <operand localId="584" locator="273:157-273:164" name="strength" xsi:type="OperandRef"/>
                                             </operand>
                                             <operand valueType="t:String" value="" xsi:type="Literal"/>
                                          </operand>
                                       </operand>
                                       <operand valueType="t:String" value="" xsi:type="Literal"/>
                                    </operand>
                                    <operand xsi:type="Coalesce">
                                       <operand localId="587" locator="273:169-273:173" valueType="t:String" value=" = " xsi:type="Literal"/>
                                       <operand valueType="t:String" value="" xsi:type="Literal"/>
                                    </operand>
                                 </operand>
                                 <operand localId="590" locator="273:177-273:195" xsi:type="ToString">
                                    <operand localId="589" locator="273:186-273:194" name="dailyDose" xsi:type="AliasRef"/>
                                 </operand>
                              </value>
                           </element>
                        </expression>
                     </return>
                  </then>
                  <else localId="607" locator="276:9-279:9" xsi:type="Tuple">
                     <element name="result">
                        <value localId="597" locator="277:19-277:34" strict="false" xsi:type="As">
                           <operand localId="595" locator="277:19-277:22" xsi:type="Null"/>
                           <asTypeSpecifier localId="596" locator="277:27-277:34" name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
                        </value>
                     </element>
                     <element name="description">
                        <value localId="606" locator="278:24-278:104" xsi:type="Concatenate">
                           <operand xsi:type="Coalesce">
                              <operand localId="603" locator="278:24-278:79" xsi:type="Concatenate">
                                 <operand xsi:type="Coalesce">
                                    <operand localId="601" locator="278:24-278:73" xsi:type="Concatenate">
                                       <operand xsi:type="Coalesce">
                                          <operand localId="598" locator="278:24-278:51" valueType="t:String" value="Unknown patch ingredient: " xsi:type="Literal"/>
                                          <operand valueType="t:String" value="" xsi:type="Literal"/>
                                       </operand>
                                       <operand xsi:type="Coalesce">
                                          <operand localId="600" locator="278:55-278:73" path="code" xsi:type="Property">
                                             <source localId="599" locator="278:55-278:68" name="ingredientCode" xsi:type="OperandRef"/>
                                          </operand>
                                          <operand valueType="t:String" value="" xsi:type="Literal"/>
                                       </operand>
                                    </operand>
                                    <operand valueType="t:String" value="" xsi:type="Literal"/>
                                 </operand>
                                 <operand xsi:type="Coalesce">
                                    <operand localId="602" locator="278:77-278:79" valueType="t:String" value=":" xsi:type="Literal"/>
                                    <operand valueType="t:String" value="" xsi:type="Literal"/>
                                 </operand>
                              </operand>
                              <operand valueType="t:String" value="" xsi:type="Literal"/>
                           </operand>
                           <operand xsi:type="Coalesce">
                              <operand localId="605" locator="278:83-278:104" path="display" xsi:type="Property">
                                 <source localId="604" locator="278:83-278:96" name="ingredientCode" xsi:type="OperandRef"/>
                              </operand>
                              <operand valueType="t:String" value="" xsi:type="Literal"/>
                           </operand>
                        </value>
                     </element>
                  </else>
               </then>
            </caseItem>
            <caseItem localId="650" locator="282:5-287:9">
               <when localId="615" locator="282:10-282:44" xsi:type="In">
                  <operand localId="611" locator="282:10-282:26" path="unit" xsi:type="Property">
                     <source localId="610" locator="282:10-282:21" name="doseQuantity" xsi:type="OperandRef"/>
                  </operand>
                  <operand localId="614" locator="282:31-282:44" xsi:type="List">
                     <element localId="612" locator="282:33-282:36" valueType="t:String" value="mg" xsi:type="Literal"/>
                     <element localId="613" locator="282:39-282:42" valueType="t:String" value="ug" xsi:type="Literal"/>
                  </operand>
               </when>
               <then localId="649" locator="283:7-287:9" xsi:type="Query">
                  <source localId="623" locator="283:7-283:95" alias="dailyDose">
                     <expression localId="622" locator="283:7-283:85" classType="t:Quantity" xsi:type="Instance">
                        <element name="value">
                           <value localId="619" locator="283:26-283:57" xsi:type="Multiply">
                              <operand localId="616" locator="283:26-283:36" name="dosesPerDay" xsi:type="OperandRef"/>
                              <operand localId="618" locator="283:40-283:57" path="value" xsi:type="Property">
                                 <source localId="617" locator="283:40-283:51" name="doseQuantity" xsi:type="OperandRef"/>
                              </operand>
                           </value>
                        </element>
                        <element name="unit">
                           <value localId="621" locator="283:66-283:82" path="unit" xsi:type="Property">
                              <source localId="620" locator="283:66-283:77" name="doseQuantity" xsi:type="OperandRef"/>
                           </value>
                        </element>
                     </expression>
                  </source>
                  <return localId="648" locator="284:9-287:9">
                     <expression localId="647" locator="284:16-287:9" xsi:type="Tuple">
                        <element name="result">
                           <value localId="624" locator="285:19-285:27" name="dailyDose" xsi:type="AliasRef"/>
                        </element>
                        <element name="description">
                           <value localId="646" locator="286:24-286:190" xsi:type="Concatenate">
                              <operand localId="643" locator="286:24-286:168" xsi:type="Concatenate">
                                 <operand localId="641" locator="286:24-286:160" xsi:type="Concatenate">
                                    <operand localId="638" locator="286:24-286:135" xsi:type="Concatenate">
                                       <operand localId="636" locator="286:24-286:125" xsi:type="Concatenate">
                                          <operand localId="633" locator="286:24-286:101" xsi:type="Concatenate">
                                             <operand localId="631" locator="286:24-286:94" xsi:type="Concatenate">
                                                <operand localId="628" locator="286:24-286:62" xsi:type="Concatenate">
                                                   <operand localId="626" locator="286:24-286:56" name="GetIngredientName" xsi:type="FunctionRef">
                                                      <operand localId="625" locator="286:42-286:55" name="ingredientCode" xsi:type="OperandRef"/>
                                                   </operand>
                                                   <operand localId="627" locator="286:60-286:62" valueType="t:String" value=" " xsi:type="Literal"/>
                                                </operand>
                                                <operand localId="630" locator="286:66-286:94" name="GetDoseFormName" xsi:type="FunctionRef">
                                                   <operand localId="629" locator="286:82-286:93" name="doseFormCode" xsi:type="OperandRef"/>
                                                </operand>
                                             </operand>
                                             <operand localId="632" locator="286:98-286:101" valueType="t:String" value=": " xsi:type="Literal"/>
                                          </operand>
                                          <operand localId="635" locator="286:105-286:125" xsi:type="ToString">
                                             <operand localId="634" locator="286:114-286:124" name="dosesPerDay" xsi:type="OperandRef"/>
                                          </operand>
                                       </operand>
                                       <operand localId="637" locator="286:129-286:135" valueType="t:String" value="/d * " xsi:type="Literal"/>
                                    </operand>
                                    <operand localId="640" locator="286:139-286:160" xsi:type="ToString">
                                       <operand localId="639" locator="286:148-286:159" name="doseQuantity" xsi:type="OperandRef"/>
                                    </operand>
                                 </operand>
                                 <operand localId="642" locator="286:164-286:168" valueType="t:String" value=" = " xsi:type="Literal"/>
                              </operand>
                              <operand localId="645" locator="286:172-286:190" xsi:type="ToString">
                                 <operand localId="644" locator="286:181-286:189" name="dailyDose" xsi:type="AliasRef"/>
                              </operand>
                           </value>
                        </element>
                     </expression>
                  </return>
               </then>
            </caseItem>
            <caseItem localId="709" locator="290:5-295:9">
               <when localId="665" locator="290:10-290:100" xsi:type="And">
                  <operand localId="654" locator="290:10-290:33" xsi:type="Equal">
                     <operand localId="652" locator="290:10-290:26" path="unit" xsi:type="Property">
                        <source localId="651" locator="290:10-290:21" name="doseQuantity" xsi:type="OperandRef"/>
                     </operand>
                     <operand localId="653" locator="290:30-290:33" valueType="t:String" value="mL" xsi:type="Literal"/>
                  </operand>
                  <operand localId="664" locator="290:39-290:100" xsi:type="Equal">
                     <operand localId="658" locator="290:40-290:71" xsi:type="PositionOf">
                        <pattern localId="655" locator="290:51-290:55" valueType="t:String" value="/mL" xsi:type="Literal"/>
                        <string localId="657" locator="290:58-290:70" path="unit" xsi:type="Property">
                           <source localId="656" locator="290:58-290:65" name="strength" xsi:type="OperandRef"/>
                        </string>
                     </operand>
                     <operand localId="663" locator="290:75-290:99" xsi:type="Subtract">
                        <operand localId="661" locator="290:75-290:95" xsi:type="Length">
                           <operand localId="660" locator="290:82-290:94" path="unit" xsi:type="Property">
                              <source localId="659" locator="290:82-290:89" name="strength" xsi:type="OperandRef"/>
                           </operand>
                        </operand>
                        <operand localId="662" locator="290:99" valueType="t:Integer" value="3" xsi:type="Literal"/>
                     </operand>
                  </operand>
               </when>
               <then localId="708" locator="291:7-295:9" xsi:type="Query">
                  <source localId="677" locator="291:7-291:118" alias="dailyDose">
                     <expression localId="676" locator="291:7-291:108" classType="t:Quantity" xsi:type="Instance">
                        <element name="value">
                           <value localId="672" locator="291:26-291:74" xsi:type="Multiply">
                              <operand localId="669" locator="291:26-291:57" xsi:type="Multiply">
                                 <operand localId="666" locator="291:26-291:36" name="dosesPerDay" xsi:type="OperandRef"/>
                                 <operand localId="668" locator="291:40-291:57" path="value" xsi:type="Property">
                                    <source localId="667" locator="291:40-291:51" name="doseQuantity" xsi:type="OperandRef"/>
                                 </operand>
                              </operand>
                              <operand localId="671" locator="291:61-291:74" path="value" xsi:type="Property">
                                 <source localId="670" locator="291:61-291:68" name="strength" xsi:type="OperandRef"/>
                              </operand>
                           </value>
                        </element>
                        <element name="unit">
                           <value localId="675" locator="291:83-291:105" name="StripPer" xsi:type="FunctionRef">
                              <operand localId="674" locator="291:92-291:104" path="unit" xsi:type="Property">
                                 <source localId="673" locator="291:92-291:99" name="strength" xsi:type="OperandRef"/>
                              </operand>
                           </value>
                        </element>
                     </expression>
                  </source>
                  <return localId="707" locator="292:9-295:9">
                     <expression localId="706" locator="292:16-295:9" xsi:type="Tuple">
                        <element name="result">
                           <value localId="678" locator="293:19-293:27" name="dailyDose" xsi:type="AliasRef"/>
                        </element>
                        <element name="description">
                           <value localId="705" locator="294:24-294:219" xsi:type="Concatenate">
                              <operand localId="702" locator="294:24-294:197" xsi:type="Concatenate">
                                 <operand xsi:type="Coalesce">
                                    <operand localId="700" locator="294:24-294:189" xsi:type="Concatenate">
                                       <operand xsi:type="Coalesce">
                                          <operand localId="697" locator="294:24-294:168" xsi:type="Concatenate">
                                             <operand localId="695" locator="294:24-294:160" xsi:type="Concatenate">
                                                <operand localId="692" locator="294:24-294:135" xsi:type="Concatenate">
                                                   <operand localId="690" locator="294:24-294:125" xsi:type="Concatenate">
                                                      <operand localId="687" locator="294:24-294:101" xsi:type="Concatenate">
                                                         <operand localId="685" locator="294:24-294:94" xsi:type="Concatenate">
                                                            <operand localId="682" locator="294:24-294:62" xsi:type="Concatenate">
                                                               <operand localId="680" locator="294:24-294:56" name="GetIngredientName" xsi:type="FunctionRef">
                                                                  <operand localId="679" locator="294:42-294:55" name="ingredientCode" xsi:type="OperandRef"/>
                                                               </operand>
                                                               <operand localId="681" locator="294:60-294:62" valueType="t:String" value=" " xsi:type="Literal"/>
                                                            </operand>
                                                            <operand localId="684" locator="294:66-294:94" name="GetDoseFormName" xsi:type="FunctionRef">
                                                               <operand localId="683" locator="294:82-294:93" name="doseFormCode" xsi:type="OperandRef"/>
                                                            </operand>
                                                         </operand>
                                                         <operand localId="686" locator="294:98-294:101" valueType="t:String" value=": " xsi:type="Literal"/>
                                                      </operand>
                                                      <operand localId="689" locator="294:105-294:125" xsi:type="ToString">
                                                         <operand localId="688" locator="294:114-294:124" name="dosesPerDay" xsi:type="OperandRef"/>
                                                      </operand>
                                                   </operand>
                                                   <operand localId="691" locator="294:129-294:135" valueType="t:String" value="/d * " xsi:type="Literal"/>
                                                </operand>
                                                <operand localId="694" locator="294:139-294:160" xsi:type="ToString">
                                                   <operand localId="693" locator="294:148-294:159" name="doseQuantity" xsi:type="OperandRef"/>
                                                </operand>
                                             </operand>
                                             <operand localId="696" locator="294:164-294:168" valueType="t:String" value=" * " xsi:type="Literal"/>
                                          </operand>
                                          <operand valueType="t:String" value="" xsi:type="Literal"/>
                                       </operand>
                                       <operand xsi:type="Coalesce">
                                          <operand localId="699" locator="294:172-294:189" xsi:type="ToString">
                                             <operand localId="698" locator="294:181-294:188" name="strength" xsi:type="OperandRef"/>
                                          </operand>
                                          <operand valueType="t:String" value="" xsi:type="Literal"/>
                                       </operand>
                                    </operand>
                                    <operand valueType="t:String" value="" xsi:type="Literal"/>
                                 </operand>
                                 <operand xsi:type="Coalesce">
                                    <operand localId="701" locator="294:193-294:197" valueType="t:String" value=" = " xsi:type="Literal"/>
                                    <operand valueType="t:String" value="" xsi:type="Literal"/>
                                 </operand>
                              </operand>
                              <operand localId="704" locator="294:201-294:219" xsi:type="ToString">
                                 <operand localId="703" locator="294:210-294:218" name="dailyDose" xsi:type="AliasRef"/>
                              </operand>
                           </value>
                        </element>
                     </expression>
                  </return>
               </then>
            </caseItem>
            <else localId="752" locator="299:7-303:9" xsi:type="Query">
               <source localId="721" locator="299:7-299:118" alias="dailyDose">
                  <expression localId="720" locator="299:7-299:108" classType="t:Quantity" xsi:type="Instance">
                     <element name="value">
                        <value localId="716" locator="299:26-299:74" xsi:type="Multiply">
                           <operand localId="713" locator="299:26-299:57" xsi:type="Multiply">
                              <operand localId="710" locator="299:26-299:36" name="dosesPerDay" xsi:type="OperandRef"/>
                              <operand localId="712" locator="299:40-299:57" path="value" xsi:type="Property">
                                 <source localId="711" locator="299:40-299:51" name="doseQuantity" xsi:type="OperandRef"/>
                              </operand>
                           </operand>
                           <operand localId="715" locator="299:61-299:74" path="value" xsi:type="Property">
                              <source localId="714" locator="299:61-299:68" name="strength" xsi:type="OperandRef"/>
                           </operand>
                        </value>
                     </element>
                     <element name="unit">
                        <value localId="719" locator="299:83-299:105" name="StripPer" xsi:type="FunctionRef">
                           <operand localId="718" locator="299:92-299:104" path="unit" xsi:type="Property">
                              <source localId="717" locator="299:92-299:99" name="strength" xsi:type="OperandRef"/>
                           </operand>
                        </value>
                     </element>
                  </expression>
               </source>
               <return localId="751" locator="300:9-303:9">
                  <expression localId="750" locator="300:16-303:9" xsi:type="Tuple">
                     <element name="result">
                        <value localId="722" locator="301:19-301:27" name="dailyDose" xsi:type="AliasRef"/>
                     </element>
                     <element name="description">
                        <value localId="749" locator="302:24-302:219" xsi:type="Concatenate">
                           <operand localId="746" locator="302:24-302:197" xsi:type="Concatenate">
                              <operand localId="744" locator="302:24-302:189" xsi:type="Concatenate">
                                 <operand localId="741" locator="302:24-302:168" xsi:type="Concatenate">
                                    <operand localId="739" locator="302:24-302:160" xsi:type="Concatenate">
                                       <operand localId="736" locator="302:24-302:135" xsi:type="Concatenate">
                                          <operand localId="734" locator="302:24-302:125" xsi:type="Concatenate">
                                             <operand localId="731" locator="302:24-302:101" xsi:type="Concatenate">
                                                <operand localId="729" locator="302:24-302:94" xsi:type="Concatenate">
                                                   <operand localId="726" locator="302:24-302:62" xsi:type="Concatenate">
                                                      <operand localId="724" locator="302:24-302:56" name="GetIngredientName" xsi:type="FunctionRef">
                                                         <operand localId="723" locator="302:42-302:55" name="ingredientCode" xsi:type="OperandRef"/>
                                                      </operand>
                                                      <operand localId="725" locator="302:60-302:62" valueType="t:String" value=" " xsi:type="Literal"/>
                                                   </operand>
                                                   <operand localId="728" locator="302:66-302:94" name="GetDoseFormName" xsi:type="FunctionRef">
                                                      <operand localId="727" locator="302:82-302:93" name="doseFormCode" xsi:type="OperandRef"/>
                                                   </operand>
                                                </operand>
                                                <operand localId="730" locator="302:98-302:101" valueType="t:String" value=": " xsi:type="Literal"/>
                                             </operand>
                                             <operand localId="733" locator="302:105-302:125" xsi:type="ToString">
                                                <operand localId="732" locator="302:114-302:124" name="dosesPerDay" xsi:type="OperandRef"/>
                                             </operand>
                                          </operand>
                                          <operand localId="735" locator="302:129-302:135" valueType="t:String" value="/d * " xsi:type="Literal"/>
                                       </operand>
                                       <operand localId="738" locator="302:139-302:160" xsi:type="ToString">
                                          <operand localId="737" locator="302:148-302:159" name="doseQuantity" xsi:type="OperandRef"/>
                                       </operand>
                                    </operand>
                                    <operand localId="740" locator="302:164-302:168" valueType="t:String" value=" * " xsi:type="Literal"/>
                                 </operand>
                                 <operand localId="743" locator="302:172-302:189" xsi:type="ToString">
                                    <operand localId="742" locator="302:181-302:188" name="strength" xsi:type="OperandRef"/>
                                 </operand>
                              </operand>
                              <operand localId="745" locator="302:193-302:197" valueType="t:String" value=" = " xsi:type="Literal"/>
                           </operand>
                           <operand localId="748" locator="302:201-302:219" xsi:type="ToString">
                              <operand localId="747" locator="302:210-302:218" name="dailyDose" xsi:type="AliasRef"/>
                           </operand>
                        </value>
                     </element>
                  </expression>
               </return>
            </else>
         </expression>
         <operand name="ingredientCode">
            <operandTypeSpecifier localId="518" locator="259:45-259:48" name="t:Code" xsi:type="NamedTypeSpecifier"/>
         </operand>
         <operand name="strength">
            <operandTypeSpecifier localId="519" locator="259:60-259:67" name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
         </operand>
         <operand name="doseFormCode">
            <operandTypeSpecifier localId="520" locator="259:83-259:86" name="t:Code" xsi:type="NamedTypeSpecifier"/>
         </operand>
         <operand name="doseQuantity">
            <operandTypeSpecifier localId="521" locator="259:102-259:109" name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
         </operand>
         <operand name="dosesPerDay">
            <operandTypeSpecifier localId="522" locator="259:124-259:130" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="836" locator="350:1-354:8" name="Quantity" context="Unfiltered" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="836">
               <a:s>define function Quantity(value </a:s>
               <a:s r="827">
                  <a:s>Decimal</a:s>
               </a:s>
               <a:s>, unit </a:s>
               <a:s r="828">
                  <a:s>String</a:s>
               </a:s>
               <a:s>):
  </a:s>
               <a:s r="835">
                  <a:s r="835">
                     <a:s>if </a:s>
                     <a:s r="830">
                        <a:s r="829">
                           <a:s>value</a:s>
                        </a:s>
                        <a:s> is not null</a:s>
                     </a:s>
                     <a:s> then
    </a:s>
                     <a:s r="833">
                        <a:s>Quantity { </a:s>
                        <a:s>
                           <a:s>value: </a:s>
                           <a:s r="831">
                              <a:s>value</a:s>
                           </a:s>
                        </a:s>
                        <a:s>, </a:s>
                        <a:s>
                           <a:s>unit: </a:s>
                           <a:s r="832">
                              <a:s>unit</a:s>
                           </a:s>
                        </a:s>
                        <a:s> }</a:s>
                     </a:s>
                     <a:s r="834">
  else
    null</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="835" locator="351:3-354:8" xsi:type="If">
            <condition localId="830" locator="351:6-351:22" xsi:type="Not">
               <operand locator="351:6-351:22" xsi:type="IsNull">
                  <operand localId="829" locator="351:6-351:10" name="value" xsi:type="OperandRef"/>
               </operand>
            </condition>
            <then localId="833" locator="352:5-352:41" classType="t:Quantity" xsi:type="Instance">
               <element name="value">
                  <value localId="831" locator="352:23-352:27" name="value" xsi:type="OperandRef"/>
               </element>
               <element name="unit">
                  <value localId="832" locator="352:36-352:39" name="unit" xsi:type="OperandRef"/>
               </element>
            </then>
            <else asType="t:Quantity" xsi:type="As">
               <operand localId="834" locator="354:5-354:8" xsi:type="Null"/>
            </else>
         </expression>
         <operand name="value">
            <operandTypeSpecifier localId="827" locator="350:32-350:38" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
         </operand>
         <operand name="unit">
            <operandTypeSpecifier localId="828" locator="350:46-350:51" name="t:String" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="844" locator="323:1-348:3" name="CalculateMMEs" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="844">
               <a:s>/*
  Calculates MMEs for the given input prescription information and returns it
  as a list of tuples:

  List&lt;Tuple {
    rxNormCode Code,
    doseFormCode Code,
    doseQuantity Quantity,
    dosesPerDay Decimal,
    ingredientCode Code,
    strength Quantity,
    dailyDose Quantity,
    dailyDoseDescription String,
    conversionFactor Decimal,
    mme Quantity
  }>
*/define function CalculateMMEs(medications </a:s>
               <a:s r="762">
                  <a:s>List&lt;</a:s>
                  <a:s r="761">
                     <a:s>Tuple { </a:s>
                     <a:s r="756">
                        <a:s>rxNormCode </a:s>
                        <a:s r="755">
                           <a:s>Code</a:s>
                        </a:s>
                     </a:s>
                     <a:s>, </a:s>
                     <a:s r="758">
                        <a:s>doseQuantity </a:s>
                        <a:s r="757">
                           <a:s>Quantity</a:s>
                        </a:s>
                     </a:s>
                     <a:s>, </a:s>
                     <a:s r="760">
                        <a:s>dosesPerDay </a:s>
                        <a:s r="759">
                           <a:s>Decimal</a:s>
                        </a:s>
                     </a:s>
                     <a:s> }</a:s>
                  </a:s>
                  <a:s>></a:s>
               </a:s>
               <a:s>):
  </a:s>
               <a:s r="843">
                  <a:s r="843">
                     <a:s>Flatten(
    </a:s>
                     <a:s r="842">
                        <a:s>
                           <a:s r="764">
                              <a:s r="763">
                                 <a:s>
                                    <a:s>medications</a:s>
                                 </a:s>
                              </a:s>
                              <a:s> M</a:s>
                           </a:s>
                        </a:s>
                        <a:s>
      </a:s>
                        <a:s>
                           <a:s>let </a:s>
                           <a:s r="768">
                              <a:s>Ingredients: </a:s>
                              <a:s r="767">
                                 <a:s>GetIngredients(</a:s>
                                 <a:s r="766">
                                    <a:s r="765">
                                       <a:s>M</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="766">
                                       <a:s>rxNormCode</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>
      </a:s>
                        <a:s r="841">
                           <a:s>return
        </a:s>
                           <a:s r="840">
                              <a:s>
                                 <a:s r="770">
                                    <a:s r="769">
                                       <a:s>
                                          <a:s>Ingredients</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s> I</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>
          </a:s>
                              <a:s>
                                 <a:s>let
            </a:s>
                                 <a:s r="773">
                                    <a:s>adjustedDoseQuantity: </a:s>
                                    <a:s r="772">
                                       <a:s r="771">
                                          <a:s>M</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="772">
                                          <a:s>doseQuantity</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>,
            </a:s>
                                 <a:s r="784">
                                    <a:s>dailyDose: </a:s>
                                    <a:s r="783">
                                       <a:s>GetDailyDose(</a:s>
                                       <a:s r="775">
                                          <a:s r="774">
                                             <a:s>I</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="775">
                                             <a:s>ingredientCode</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>, </a:s>
                                       <a:s r="777">
                                          <a:s r="776">
                                             <a:s>I</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="777">
                                             <a:s>strength</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>, </a:s>
                                       <a:s r="779">
                                          <a:s r="778">
                                             <a:s>I</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="779">
                                             <a:s>doseFormCode</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>, </a:s>
                                       <a:s r="780">
                                          <a:s>adjustedDoseQuantity</a:s>
                                       </a:s>
                                       <a:s>, </a:s>
                                       <a:s r="782">
                                          <a:s r="781">
                                             <a:s>M</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="782">
                                             <a:s>dosesPerDay</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>)</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>,
            </a:s>
                                 <a:s r="795">
                                    <a:s>factor: </a:s>
                                    <a:s r="794">
                                       <a:s r="785">
                                          <a:s>ConversionFactors</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="794">
                                          <a:s>GetConversionFactor(</a:s>
                                          <a:s r="787">
                                             <a:s r="786">
                                                <a:s>I</a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="787">
                                                <a:s>ingredientCode</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s>, </a:s>
                                          <a:s r="789">
                                             <a:s r="788">
                                                <a:s>dailyDose</a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="789">
                                                <a:s>result</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s>, </a:s>
                                          <a:s r="791">
                                             <a:s r="790">
                                                <a:s>I</a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="791">
                                                <a:s>doseFormCode</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s>, </a:s>
                                          <a:s r="793">
                                             <a:s r="792">
                                                <a:s>M</a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="793">
                                                <a:s>dosesPerDay</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s>)</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>
          </a:s>
                              <a:s r="839">
                                 <a:s>return </a:s>
                                 <a:s r="838">
                                    <a:s>{
            </a:s>
                                    <a:s>
                                       <a:s>rxNormCode: </a:s>
                                       <a:s r="797">
                                          <a:s r="796">
                                             <a:s>M</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="797">
                                             <a:s>rxNormCode</a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>,
            </a:s>
                                    <a:s>
                                       <a:s>doseFormCode: </a:s>
                                       <a:s r="799">
                                          <a:s r="798">
                                             <a:s>I</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="799">
                                             <a:s>doseFormCode</a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>,
            </a:s>
                                    <a:s>
                                       <a:s>doseQuantity: </a:s>
                                       <a:s r="800">
                                          <a:s>adjustedDoseQuantity</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>,
            </a:s>
                                    <a:s>
                                       <a:s>dosesPerDay: </a:s>
                                       <a:s r="802">
                                          <a:s r="801">
                                             <a:s>M</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="802">
                                             <a:s>dosesPerDay</a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>,
            </a:s>
                                    <a:s>
                                       <a:s>ingredientCode: </a:s>
                                       <a:s r="804">
                                          <a:s r="803">
                                             <a:s>I</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="804">
                                             <a:s>ingredientCode</a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>,
            </a:s>
                                    <a:s>
                                       <a:s>strength: </a:s>
                                       <a:s r="806">
                                          <a:s r="805">
                                             <a:s>I</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="806">
                                             <a:s>strength</a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>,
            </a:s>
                                    <a:s>
                                       <a:s>dailyDose: </a:s>
                                       <a:s r="808">
                                          <a:s r="807">
                                             <a:s>dailyDose</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="808">
                                             <a:s>result</a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>,
            </a:s>
                                    <a:s>
                                       <a:s>dailyDoseDescription: </a:s>
                                       <a:s r="817">
                                          <a:s r="810">
                                             <a:s r="809">
                                                <a:s>dailyDose</a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="810">
                                                <a:s>description</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s> &amp; </a:s>
                                          <a:s r="816">
                                             <a:s>(</a:s>
                                             <a:s r="816">
                                                <a:s r="811">
                                                   <a:s>' * factor: '</a:s>
                                                </a:s>
                                                <a:s> + </a:s>
                                                <a:s r="815">
                                                   <a:s>Coalesce(</a:s>
                                                   <a:s r="813">
                                                      <a:s>ToString(</a:s>
                                                      <a:s r="812">
                                                         <a:s>factor</a:s>
                                                      </a:s>
                                                      <a:s>)</a:s>
                                                   </a:s>
                                                   <a:s>, </a:s>
                                                   <a:s r="814">
                                                      <a:s>'No conversion factor available'</a:s>
                                                   </a:s>
                                                   <a:s>)</a:s>
                                                </a:s>
                                             </a:s>
                                             <a:s>)</a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>,
            </a:s>
                                    <a:s>
                                       <a:s>conversionFactor: </a:s>
                                       <a:s r="818">
                                          <a:s>factor</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>,
            </a:s>
                                    <a:s>
                                       <a:s>mme: </a:s>
                                       <a:s r="837">
                                          <a:s>Quantity(
              </a:s>
                                          <a:s r="825">
                                             <a:s>Round(</a:s>
                                             <a:s r="823">
                                                <a:s r="821">
                                                   <a:s r="820">
                                                      <a:s r="819">
                                                         <a:s>dailyDose</a:s>
                                                      </a:s>
                                                      <a:s>.</a:s>
                                                      <a:s r="820">
                                                         <a:s>result</a:s>
                                                      </a:s>
                                                   </a:s>
                                                   <a:s>.</a:s>
                                                   <a:s r="821">
                                                      <a:s>value</a:s>
                                                   </a:s>
                                                </a:s>
                                                <a:s> * </a:s>
                                                <a:s r="822">
                                                   <a:s>factor</a:s>
                                                </a:s>
                                             </a:s>
                                             <a:s r="824">, 1)</a:s>
                                          </a:s>
                                          <a:s>,
              </a:s>
                                          <a:s r="826">
                                             <a:s>'{MME}/d'</a:s>
                                          </a:s>
                                          <a:s>
            )</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>
          }</a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>
  )</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="843" locator="324:3-348:3" xsi:type="Flatten">
            <operand localId="842" locator="325:5-347:11" xsi:type="Query">
               <source localId="764" locator="325:5-325:17" alias="M">
                  <expression localId="763" locator="325:5-325:15" name="medications" xsi:type="OperandRef"/>
               </source>
               <let localId="768" locator="326:11-326:51" identifier="Ingredients">
                  <expression localId="767" locator="326:24-326:51" name="GetIngredients" xsi:type="FunctionRef">
                     <operand localId="766" locator="326:39-326:50" path="rxNormCode" scope="M" xsi:type="Property"/>
                  </expression>
               </let>
               <return localId="841" locator="327:7-347:11">
                  <expression localId="840" locator="328:9-347:11" xsi:type="Query">
                     <source localId="770" locator="328:9-328:21" alias="I">
                        <expression localId="769" locator="328:9-328:19" name="Ingredients" xsi:type="QueryLetRef"/>
                     </source>
                     <let localId="773" locator="330:13-330:48" identifier="adjustedDoseQuantity">
                        <expression localId="772" locator="330:35-330:48" path="doseQuantity" scope="M" xsi:type="Property"/>
                     </let>
                     <let localId="784" locator="331:13-331:118" identifier="dailyDose">
                        <expression localId="783" locator="331:24-331:118" name="GetDailyDose" xsi:type="FunctionRef">
                           <operand localId="775" locator="331:37-331:52" path="ingredientCode" scope="I" xsi:type="Property"/>
                           <operand localId="777" locator="331:55-331:64" path="strength" scope="I" xsi:type="Property"/>
                           <operand localId="779" locator="331:67-331:80" path="doseFormCode" scope="I" xsi:type="Property"/>
                           <operand localId="780" locator="331:83-331:102" name="adjustedDoseQuantity" xsi:type="QueryLetRef"/>
                           <operand localId="782" locator="331:105-331:117" path="dosesPerDay" scope="M" xsi:type="Property"/>
                        </expression>
                     </let>
                     <let localId="795" locator="332:13-332:124" identifier="factor">
                        <expression localId="794" locator="332:21-332:124" name="GetConversionFactor" libraryName="ConversionFactors" xsi:type="FunctionRef">
                           <operand localId="787" locator="332:59-332:74" path="ingredientCode" scope="I" xsi:type="Property"/>
                           <operand localId="789" locator="332:77-332:92" path="result" xsi:type="Property">
                              <source localId="788" locator="332:77-332:85" name="dailyDose" xsi:type="QueryLetRef"/>
                           </operand>
                           <operand localId="791" locator="332:95-332:108" path="doseFormCode" scope="I" xsi:type="Property"/>
                           <operand localId="793" locator="332:111-332:123" path="dosesPerDay" scope="M" xsi:type="Property"/>
                        </expression>
                     </let>
                     <return localId="839" locator="333:11-347:11">
                        <expression localId="838" locator="333:18-347:11" xsi:type="Tuple">
                           <element name="rxNormCode">
                              <value localId="797" locator="334:25-334:36" path="rxNormCode" scope="M" xsi:type="Property"/>
                           </element>
                           <element name="doseFormCode">
                              <value localId="799" locator="335:27-335:40" path="doseFormCode" scope="I" xsi:type="Property"/>
                           </element>
                           <element name="doseQuantity">
                              <value localId="800" locator="336:27-336:46" name="adjustedDoseQuantity" xsi:type="QueryLetRef"/>
                           </element>
                           <element name="dosesPerDay">
                              <value localId="802" locator="337:26-337:38" path="dosesPerDay" scope="M" xsi:type="Property"/>
                           </element>
                           <element name="ingredientCode">
                              <value localId="804" locator="338:29-338:44" path="ingredientCode" scope="I" xsi:type="Property"/>
                           </element>
                           <element name="strength">
                              <value localId="806" locator="339:23-339:32" path="strength" scope="I" xsi:type="Property"/>
                           </element>
                           <element name="dailyDose">
                              <value localId="808" locator="340:24-340:39" path="result" xsi:type="Property">
                                 <source localId="807" locator="340:24-340:32" name="dailyDose" xsi:type="QueryLetRef"/>
                              </value>
                           </element>
                           <element name="dailyDoseDescription">
                              <value localId="817" locator="341:35-341:136" xsi:type="Concatenate">
                                 <operand xsi:type="Coalesce">
                                    <operand localId="810" locator="341:35-341:55" path="description" xsi:type="Property">
                                       <source localId="809" locator="341:35-341:43" name="dailyDose" xsi:type="QueryLetRef"/>
                                    </operand>
                                    <operand valueType="t:String" value="" xsi:type="Literal"/>
                                 </operand>
                                 <operand xsi:type="Coalesce">
                                    <operand localId="816" locator="341:59-341:136" xsi:type="Concatenate">
                                       <operand localId="811" locator="341:60-341:72" valueType="t:String" value=" * factor: " xsi:type="Literal"/>
                                       <operand localId="815" locator="341:76-341:135" xsi:type="Coalesce">
                                          <operand localId="813" locator="341:85-341:100" xsi:type="ToString">
                                             <operand localId="812" locator="341:94-341:99" name="factor" xsi:type="QueryLetRef"/>
                                          </operand>
                                          <operand localId="814" locator="341:103-341:134" valueType="t:String" value="No conversion factor available" xsi:type="Literal"/>
                                       </operand>
                                    </operand>
                                    <operand valueType="t:String" value="" xsi:type="Literal"/>
                                 </operand>
                              </value>
                           </element>
                           <element name="conversionFactor">
                              <value localId="818" locator="342:31-342:36" name="factor" xsi:type="QueryLetRef"/>
                           </element>
                           <element name="mme">
                              <value localId="837" locator="343:18-346:13" name="Quantity" xsi:type="FunctionRef">
                                 <operand localId="825" locator="344:15-344:55" xsi:type="Round">
                                    <operand localId="823" locator="344:21-344:51" xsi:type="Multiply">
                                       <operand localId="821" locator="344:21-344:42" path="value" xsi:type="Property">
                                          <source localId="820" locator="344:21-344:36" path="result" xsi:type="Property">
                                             <source localId="819" locator="344:21-344:29" name="dailyDose" xsi:type="QueryLetRef"/>
                                          </source>
                                       </operand>
                                       <operand localId="822" locator="344:46-344:51" name="factor" xsi:type="QueryLetRef"/>
                                    </operand>
                                    <precision localId="824" locator="344:54" valueType="t:Integer" value="1" xsi:type="Literal"/>
                                 </operand>
                                 <operand localId="826" locator="345:15-345:23" valueType="t:String" value="{MME}/d" xsi:type="Literal"/>
                              </value>
                           </element>
                        </expression>
                     </return>
                  </expression>
               </return>
            </operand>
         </expression>
         <operand name="medications">
            <operandTypeSpecifier localId="762" locator="323:43-323:117" xsi:type="ListTypeSpecifier">
               <elementType localId="761" locator="323:48-323:116" xsi:type="TupleTypeSpecifier">
                  <element localId="756" locator="323:56-323:70" name="rxNormCode">
                     <elementType localId="755" locator="323:67-323:70" name="t:Code" xsi:type="NamedTypeSpecifier"/>
                  </element>
                  <element localId="758" locator="323:73-323:93" name="doseQuantity">
                     <elementType localId="757" locator="323:86-323:93" name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
                  </element>
                  <element localId="760" locator="323:96-323:114" name="dosesPerDay">
                     <elementType localId="759" locator="323:108-323:114" name="t:Decimal" xsi:type="NamedTypeSpecifier"/>
                  </element>
               </elementType>
            </operandTypeSpecifier>
         </operand>
      </def>
   </statements>
</library>
